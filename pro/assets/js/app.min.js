"use strict";var toast_message,$$=Dom7,app=new Framework7({root:"#app",id:"com.anyinspect.pro",name:"Framework7",material:!0,theme:"ios",methods:{helloWorld:function(){app.dialog.alert("Hello World!")}},view:{pushState:!0,history:!0,pushStateSeparator:"#",pushStateRoot:"/dnata/",pushStateOnLoad:!1,browserHistory:!1,iosDynamicNavbar:!1},smartSelect:{popupCloseLinkText:"Ok",sheetCloseLinkText:"Ok",searchbarDisableText:"Cancelar",pageBackLinkText:"Voltar",searchbarPlaceholder:"Procurar"},photoBrowser:{type:"standalone",popupCloseLinkText:"Ok",sheetCloseLinkText:"Ok",searchbarDisableText:"Cancelar",pageBackLinkText:"Voltar",searchbarPlaceholder:"Procurar"},popup:{closeByBackdropClick:!1},actions:{convertToPopover:!1,grid:!0},routes:routes,popup:{closeOnEscape:!0},sheet:{closeOnEscape:!0},popover:{closeOnEscape:!0},actions:{closeOnEscape:!0}});let deferredPrompt;document.addEventListener("DOMContentLoaded",()=>{if("serviceWorker"in navigator)if("PushManager"in window)if("Notification"in window)if("showNotification"in ServiceWorkerRegistration.prototype)if("denied"==Notification.permission)console.log("Notifications are disabled.");else{function e(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),a=window.atob(t),s=new Uint8Array(a.length);for(let e=0;e<a.length;++e)s[e]=a.charCodeAt(e);return s}function t(e){if(e){const t=e.getKey("p256dh"),a=e.getKey("auth"),s=(PushManager.supportedContentEncodings||["aesgcm"])[0],i={endpoint:e.endpoint,publicKey:t?btoa(String.fromCharCode.apply(null,new Uint8Array(t))):null,authToken:a?btoa(String.fromCharCode.apply(null,new Uint8Array(a))):null,contentEncoding:s};return window.localStorage.setItem("user_info_push_insp",JSON.stringify(i)),e}}navigator.serviceWorker.register("service-worker.js").then(e=>{console.log("Service Worker Registered"),e.active&&e.addEventListener("updatefound",()=>{console.log("Update found. Waiting for install to complete.");const t=e.installing;t.addEventListener("statechange",()=>{"installed"===t.state&&(console.log("Install complete. Triggering update prompt."),app.toast.create({text:"Nova versão disponível",closeButton:!0,on:{close:function(){location.reload()}}}).open())})})}).catch(e=>console.log(e)),navigator.serviceWorker.ready.then(e=>e.pushManager.getSubscription()).then(a=>(navigator.serviceWorker.ready.then(t=>t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e("BMPVQVgOVhIw7XzIAj-LMJztv-7IUBMTTuTBm3AWs135sOy_hRtJ7GutB-AAxOZPSEcNHsekE9iFhQjYrublIaw")})).then(e=>t(e)),t(a)))}else console.log("Notifications aren’t supported.");else console.log("Notifications API isn’t supported.");else console.log("Push API isn’t supported.");else console.log("Service Worker API isn’t supported.")});const isIos=()=>{const e=window.navigator.userAgent.toLowerCase();return/iphone|ipad|ipod/.test(e)},isInStandaloneMode=()=>"standalone"in window.navigator&&window.navigator.standalone;if(isIos()&&!isInStandaloneMode()){var installios=app.sheet.create({el:".install_app_ios",swipeToClose:!0,swipeToStep:!0,backdrop:!0});setTimeout(function(){},1500)}function call_open_events(){let e=Utils.userData();null!=e&&"null"!=e||app.views.main.router.navigate({name:"sign-in"});var t=e.id,a=e.type;null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"}),$$("#open_list_approve").html('<img src="assets/img/load_cont.gif" />'),fetch(current_path+"/view/get_open_events_group",{method:"POST",headers:new Headers,body:JSON.stringify({IdUser:t,type:a})}).then(e=>e.json()).then(e=>{var t="",a="",s="",i=e.status,o="",n="",l=0;"SUCCESS"==i?(e.data.forEach(function(e){if("Pendente"==(o=e.status_)&&(s="list_status_pendente"),"Em Andamento"==o&&(o="Em Andamento",s="list_status_andamento","read"),"Cancelado"==o&&(o="Cancelado",s="list_status_cancelado","read"),"Deletado"==o&&(o="Deletado",s="list_status_deletado"),"Concluído"==o&&(o="Concluído",s="list_status_concluido","read"),"Finalizado"==o&&(s="list_status_finalizado","read"),l=e.total_groups,e.desc_service.length>31)var i=e.desc_service.substring(0,28)+"...";else i=e.desc_service;n=l>1?"/atividade-grupo/"+e.id_group:"/atividade/"+e.id,"Finalizado"==o&&(t+='<div class="patient-widget"><div class="patient-top-details"><div><span class="invoice-id"><strong>'+e.br_start+'</strong></span></div><div><span class="date-col '+s+'">'+o+'</span></div></div><div class="invoice-widget"><div class="pat-info-left"><div class="patient-img"><a href="'+n+'"><img src="'+e.foto_cliente+'" class="img-fluid" alt="User Image"></a></div><div class="pat-info-cont"><h4 class="pat-name"><a href="'+n+'">'+i+'</a></h4><div class="patient-details-col"><span class="">#'+e.id_group+'</span></div><div class="hour-col"><div><span class="hours">'+e.nome_cliente+"</span></div></div></div></div></div></div>"),"Pendente"!=o&&"Em Andamento"!=o&&"Finalizado"!=o||(a+='<div class="patient-widget"><div class="patient-top-details"><div><span class="invoice-id"><strong>'+e.br_start+'</strong></span></div><div><span class="date-col '+s+'">'+o+'</span></div></div><div class="invoice-widget"><div class="pat-info-left"><div class="patient-img"><a href="'+n+'"><img src="'+e.foto_cliente+'" class="img-fluid" alt="User Image"></a></div><div class="pat-info-cont"><h4 class="pat-name"><a href="'+n+'">'+i+'</a></h4><div class="patient-details-col"><span class="">#'+e.id_group+'</span></div><div class="hour-col"><div><span class="hours">'+e.nome_cliente+"</span></div></div></div></div></div></div>")}),""==t?$$("#open_list_approve").html('<h2 style="text-align: center;margin-top: 80px;color: #ececec;font-size: 125px;">0</h2>'):$$("#open_list_approve").html(t),""==a?$$("#open_list_pending").html('<h2 style="text-align: center;margin-top: 80px;color: #ececec;font-size: 125px;">0</h2>'):$$("#open_list_pending").html(a),$$("#open_list_pending").html(a)):($$("#open_list_approve").html('<h2 style="text-align: center;margin-top: 80px;color: #ececec;font-size: 125px;">0</h2>'),$$("#open_list_pending").html('<h2 style="text-align: center;margin-top: 80px;color: #ececec;font-size: 125px;">0</h2>')),$("#search_events_approve").keyup(function(){var e=this,t=$("#open_list_approve > div"),a=t.filter(function(t,a){var s=$(a).text().toUpperCase(),i=e.value.toUpperCase();return~s.indexOf(i)});t.hide(),a.show()}),$("#search_events_pending").keyup(function(){var e=this,t=$("#open_list_pending > div"),a=t.filter(function(t,a){var s=$(a).text().toUpperCase(),i=e.value.toUpperCase();return~s.indexOf(i)});t.hide(),a.show()})}).catch(e=>console.log(e))}function call_user_profile(){let e=Utils.userData();null!=e&&"null"!=e||app.views.main.router.navigate({name:"sign-in"});var t=e.id,a=e.type;null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});var s;s='<div id="box_action_sig_user"  ></div><div id="/signature-page-user/'+t+'" class="box row "><div style="background: #18998d;padding: 10px;border-radius: 20px;" class="col-100"><a href="/signature-page-user/'+t+'" style="width:100%;color: #fff;" class="item-link item-content link "><i class="fa fa-pencil-square-o" style="font-size: 16px;"></i>Editar assinatura</a></div></div>',$$("#box_sig_user").html(s),fetch(current_path+"/view/get_user_profile",{method:"POST",headers:new Headers,body:JSON.stringify({IdUser:t,type:a})}).then(e=>e.json()).then(e=>{var t=e.status,a=e.data[0],s=e.qual,i=e.habil,o=e.links,n="";if("SUCCESS"==t){$$(".user_name_").html(a.name),$$(".user_email_").html(a.email),$$(".user_phone_").html(a.phone),$$(".user_cracha_").html(a.cracha_aeroporto),$$(".user_data_admicao_").html(a.data_admicao),""!=a.foto&&$$("#user_pic_").html('<img src="'+a.foto+'" alt="">'),"null"==a.sign||null==a.sign||(n='<div class="title-col-100" style="padding:10px"><h6 style="width:100%;"><img src="'+a.sign+'" alt=""></h6></div>',$("#box_action_sig_user").html(n));var l="";s?s.forEach(function(e){l+='<li><div class="item-head"><h5 class="title">'+e.desc_qual+'</h5><div class="dz-meta"><ul class=""><li>Vencimento:</li><li class="">'+e.validade_qual+'</li></ul></div></div><div class="pts-bx"><h3 class="points '+e.status+'">'+e.dias_expira+" dias</h3></div></li>"}):l="Não Encontrado",$("#lista_qual").html(l);var c="";i?i.forEach(function(e){c+='<li><div class="item-head"><h5 class="title">'+e.descricao+'</h5><h6 class="title">'+e.valor+'</h6><div class="dz-meta"><ul class=""><li>Vencimento:</li><li class="">'+e.data_expira+'</li></ul></div></div><div class="pts-bx"><h3 class="points '+e.status+'">'+e.dias_expira+" dias</h3></div></li>"}):c='<li class="text-center">Sem Informação</li>',$("#lista_habilitacao").html(c);var r="";o?o.forEach(function(e){r+='<li><div class="item-head"><a target="_blank" class="link external" href="'+e.link+'">'+e.descricao+"</a>"}):r='<li class="text-center">Sem Informação</li>',$("#lista_links").html(r)}}).catch(e=>console.log(e))}function call_open_events_groups(e){let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});var a=t.id,s=t.type;null!=a&&"null"!=a||app.views.main.router.navigate({name:"sign-in"}),$$("#open_list_grupo").html('<img src="assets/img/load_cont.gif" />'),fetch(current_path+"/view/get_evento_group",{method:"POST",headers:new Headers,body:JSON.stringify({IdUser:a,type:s,id_group:e})}).then(e=>e.json()).then(e=>{var t="",a="",s=e.status,i="",o="",n="",l=e.per;if("SUCCESS"==s){var c=e.data[0].endereco_cliente,r=e.data[0].cidade_cliente,d=e.data[0].cep_cliente,p=e.data[0].num_cliente,u=e.data[0].bairro_cliente;e.data[0].phone_cliente;""!=c&&(c=c),""!=r&&(r=" , "+r),""!=p&&(p=" , "+p),""!=d&&(d=" , "+d),""!=u&&(u=" , "+u);var v=c+u+p+r+d;e.data.forEach(function(e){if("Pendente"==(i=e.status_)&&(a="list_status_pendente"),"Em Andamento"==i&&(i="Em Andamento",a="list_status_andamento","read"),"Cancelado"==i&&(i="Cancelado",a="list_status_cancelado","read"),"Deletado"==i&&(i="Deletado",a="list_status_deletado"),"Concluído"==i&&(i="Concluído",a="list_status_concluido","read"),"Finalizado"==i&&(a="list_status_finalizado","read"),e.total_groups,$$("#foto_empresa_gru").html('<img style="min-width: 70px;min-height: 70px;border-radius: 50%;" src="'+e.foto_cliente+'" alt="">'),$$("#nome_empresa_gru").html("<strong>"+e.nome_cliente+"</strong>"),$$("#end_empresa_gru").html('<div><i style="color:#9c9c9c;" class="fa fa-map-marker"></i> <small>'+v+"</small></div>"),$$("#phone_cliente_gru").html('<i style="color:#9c9c9c;" class="fa fa-phone"></i> <small>'+e.phone_cliente+"</small>"),e.desc_service.length>35)var s=e.desc_service.substring(0,34)+"...";else s=e.desc_service;o="/atividade/"+e.id,t+='<div class="patient-widget"><a href="'+o+'"><div class="patient-top-details"><div><span class="invoice-id"><strong>'+e.qrcode+'</strong></span></div><div><span class="date-col '+a+'">'+i+'</span></div></div><div class="invoice-widgets"><div class="pat-info-lefts"><div class="pat-info-conts"><h4 class="pat-name"><a href="'+o+'"> <strong>'+e.ativo+'</strong></a></h4><div class="patient-details-col"><span class="">#'+e.id+" "+s+'</span></div><div class="hour-col"><div><h5 class="hours">'+e.br_start+"</h5></div></div></div></div></div></a></div>"}),n='<h6 class="mt-4">'+l+'% Completo</h6><div class="progress mb-3"><div class="progress-bar bg-primary" style="width:'+l+'%; height:6px;" role="progressbar"><span class="sr-only">'+l+"% Completo</span></div></div>",$$("#open_list_grupo").html(t),$$("#percent_act").html(n)}else $$("#open_list_grupo").html('<h2 style="text-align: center;margin-top: 80px;color: #ececec;font-size: 125px;">0</h2>');$("#search_events_all").keyup(function(){var e=this,t=$("#open_list_grupo > div"),a=t.filter(function(t,a){var s=$(a).text().toUpperCase(),i=e.value.toUpperCase();return~s.indexOf(i)});t.hide(),a.show()})}).catch(e=>console.log(e))}function get_calendar(){var e;$$("#calendar-inline-container-book").html("");var t="",a=new Date;1==(e=a.getMonth()+1)&&(t="Jan"),2==e&&(t="Fev"),3==e&&(t="Mar"),4==e&&(t="Abr"),5==e&&(t="Mai"),6==e&&(t="Jun"),7==e&&(t="Jul"),8==e&&(t="Ago"),9==e&&(t="Set"),10==e&&(t="Out"),11==e&&(t="Nov"),12==e&&(t="Dez"),a.getDate(),$$("#calendar_serv").html('<img src="assets/img/load_cont.gif" />');var s=new Date;new Date(s.getFullYear(),s.getMonth(),s.getDate());let i=new Date;(n=i.getDate())<10&&(n="0"+n),(l=i.getMonth()+1)<10&&(l="0"+l);let o=i.getFullYear()+"-"+l+"-"+n;var n=0,l=0,c="";let r,d,p,u;var v=0;let _=Utils.userData();null!=_&&"null"!=_||app.views.main.router.navigate({name:"sign-in"});var m=_.id,g=_.type;null!=m&&"null"!=m||app.views.main.router.navigate({name:"sign-in"}),fetch(current_path+"/view/get_open_events_group_calendar",{method:"POST",headers:new Headers,body:JSON.stringify({IdUser:m,the_date:o,type:g})}).then(e=>e.json()).then(e=>{e.content;"SUCCESS"==e.status?(e.content.forEach(function(e){var t;if("Pendente"==(p=e.status_)&&(d="list_status_pendente"),"Em Andamento"==p&&(p="Em Andamento",d="list_status_andamento",u="read"),"Cancelado"==p&&(p="Cancelado",d="list_status_cancelado",u="read"),"Deletado"==p&&(p="Deletado",d="list_status_deletado"),"Concluído"==p&&(p="Concluído",d="list_status_concluido",u="read"),"Finalizado"==p&&(d="list_status_finalizado",u="read"),e.desc_service.length>31)var a=e.desc_service.substring(0,32)+"...";else a=e.desc_service;t=e.total_groups>1?"/atividade-grupo/"+e.id_group:"/atividade/"+e.id,c+='<div class="patient-widget"><div class="patient-top-details"><div><span class="invoice-id"><strong>'+e.br_start+'</strong></span></div><div><span class="date-col '+d+'">'+p+'</span></div></div><div class="invoice-widget"><div class="pat-info-left"><div class="patient-img"><a href="'+t+'"><img src="'+e.foto_cliente+'" class="img-fluid" alt="User Image"></a></div><div class="pat-info-cont"><h4 class="pat-name"><a href="'+t+'">'+a+'</a></h4><div class="patient-details-col"><span class="">#'+e.id_group+'</span></div><div class="hour-col"><div><span class="hours">'+e.nome_cliente+"</span></div></div></div></div></div></div>"}),$$("#calendar_serv").html(c)):$$("#calendar_serv").html('<div class="block-title" style="text-align: center;"><h3>Nenhuma Atividade</h3></div>')}).catch(e=>console.log(e));new Date("2020","03","12");var f=["Janeiro","Fevereiro","Maço","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],h=app.calendar.create({containerEl:"#calendar-inline-container-book",value:[new Date],weekHeader:!0,renderToolbar:function(){return'<div class="toolbar calendar-custom-toolbar no-shadow"><div class="toolbar-inner"><div class="left"><a href="#" class="link icon-only"><i class="icon icon-back '+("md"===app.theme?"color-black":"")+'"></i></a></div><div class="center"></div><div class="right"><a href="#" class="link icon-only"><i class="icon icon-forward '+("md"===app.theme?"color-black":"")+'"></i></a></div></div></div>'},on:{change:function(e){},opened:function(e){},init:function(e){$$(".calendar-custom-toolbar .center").text(f[e.currentMonth]+", "+e.currentYear),$$(".calendar-custom-toolbar .left .link").on("click",function(){h.prevMonth()}),$$(".calendar-custom-toolbar .right .link").on("click",function(){h.nextMonth()})},monthYearChangeStart:function(e){$$(".calendar-custom-toolbar .center").text(f[e.currentMonth]+", "+e.currentYear)},dayClick:function(e,t,a,s,i){},dayClick:function(e,t,a,s,i){i<10&&(i="0"+i),(s+=1)<10&&(s="0"+s),$$("#calendar_serv").html('<img src="assets/img/load_cont.gif"> '),o=a+"-"+s+"-"+i;let n=Utils.userData();null!=n&&"null"!=n||app.views.main.router.navigate({name:"sign-in"});let l=n.id,_=n.type;fetch(current_path+"/view/get_open_events_group_calendar",{method:"POST",headers:new Headers,body:JSON.stringify({IdUser:l,the_date:o,type:_})}).then(e=>e.json()).then(e=>{c="",v=e.total_month,"SUCCESS"==(r=e.status)?($$("#title_total_calendar").show(),$$("#total_month_all").html(v),e.content.forEach(function(e){var t;if("Pendente"==(p=e.status_)&&(d="list_status_pendente"),"Em Andamento"==p&&(p="Em Andamento",d="list_status_andamento",u="read"),"Cancelado"==p&&(p="Cancelado",d="list_status_cancelado",u="read"),"Deletado"==p&&(p="Deletado",d="list_status_deletado"),"Concluído"==p&&(p="Concluído",d="list_status_concluido",u="read"),"Finalizado"==p&&(d="list_status_finalizado",u="read"),e.desc_service.length>31)var a=e.desc_service.substring(0,32)+"...";else a=e.desc_service;t=e.total_groups>1?"/atividade-grupo/"+e.id_group:"/atividade/"+e.id,c+='<div class="patient-widget"><div class="patient-top-details"><div><span class="invoice-id"><strong>'+e.br_start+'</strong></span></div><div><span class="date-col '+d+'">'+p+'</span></div></div><div class="invoice-widget"><div class="pat-info-left"><div class="patient-img"><a href="'+t+'"><img src="'+e.foto_cliente+'" class="img-fluid" alt="User Image"></a></div><div class="pat-info-cont"><h4 class="pat-name"><a href="'+t+'">'+a+'</a></h4><div class="patient-details-col"><span class="">#'+e.id_group+'</span></div><div class="hour-col"><div><span class="hours">'+e.nome_cliente+"</span></div></div></div></div></div></div>"}),$$("#calendar_serv").html(c)):($$("#title_total_calendar").hide(),$$("#total_month_all").html(""),$$("#calendar_serv").html('<div class="block-title" style="text-align: center;"><h3>Nenhuma Atividade</h3></div>'),$$(".load_agenda").html(""))}).catch(e=>console.log(e))}}});$("#search_events_month").keyup(function(){var e=this,t=$("#calendar_serv > div"),a=t.filter(function(t,a){var s=$(a).text().toUpperCase(),i=e.value.toUpperCase();return~s.indexOf(i)});t.hide(),a.show()})}function get_calendar_single(){var e,t=new Date,a=t.getUTCMonth(),s=t.getUTCDate(),i=t.getUTCFullYear();s<10&&(s="0"+s),(a+=1)<10&&(a="0"+a),$$(".load_agenda").html('<img style="width: 100px;margin: auto;" src="images/load.gif"> '),e=i+"-"+a+"-"+s;let o=Utils.userData();null!=o&&"null"!=o||app.views.main.router.navigate({name:"sign-in"});let n=o.id;fetch(current_path+"/view/get_open_service_month",{method:"POST",headers:new Headers,body:JSON.stringify({IdUser:n,the_date:e})}).then(e=>e.json()).then(e=>{var t="";let a,s;var i,o="";i=e.total_month,"SUCCESS"==(a=e.status)?($$("#title_total_calendar").show(),$$("#total_month_all").html(i),e.data?e.data.forEach(function(e){"Pendente"==(a=e.status)&&(s="pendente"),"Em Andamento"==a&&(a="Andamento",s="andamento"),"Finalizado"==a&&(s="finalizado"),"Cancelado"==a&&(s="cancelado"),"Deletado"==a&&(s="deletado"),"Aprovado"==a&&(s="aprovado"),"Concluído"==a||("Alta"==(o=e.priority)?(o='<span style="color:#F44336;background: #F44336;clip-path: polygon( 0% 100%, 100% 100%, 100% 0%);">Alta</span>',"alta_shadow"):"Média"==o?(o='<span style="color:#f1c951;background: #f1c951;clip-path: polygon( 0% 100%, 100% 100%, 100% 0%);">Alta</span>',""):(o="","")),$$(".load_agenda").html(""),t+='<div class="patient-widget"><div class="patient-top-details"><div><span class="invoice-id"><strong>'+e.br_start+'</strong></span></div><div><span class="date-col '+s+'">'+a+'</span></div></div><div class="invoice-widget"><div class="pat-info-left"><div class="patient-img"><a href="'+link_page+'"><img src="'+e.foto_cliente+'" class="img-fluid" alt="User Image"></a></div><div class="pat-info-cont"><h4 class="pat-name"><a href="'+link_page+'">'+desc_service+'</a></h4><div class="patient-details-col"><span class="">#'+e.id_group+'</span></div><div class="hour-col"><div><span class="hours">'+e.nome_cliente+"</span></div></div></div></div></div></div>"}):(t="",$$(".load_agenda").html("")),$$("#calendar_serv").html(t)):($$("#title_total_calendar").hide(),$$("#total_month_all").html(""),$$("#calendar_serv").html('<div class="block-title" style="text-align: center;"><h3>Nenhuma Atividade</h3></div>'),$$(".load_agenda").html(""))}).catch(e=>console.log(e))}function get_info_gerais(e){$$("#boxcanvas_cli").width();let t=Utils.userData();if(null===t||"null"===t)return app.views.main.router.navigate({name:"sign-in"}),app.views.main.router.navigate("/sign-in/"),void app.views.main.router.navigate("/sign-in/",{clearPreviousHistory:!0});t.id;let a=t.type;fetch(current_path+"/view/get_eventos_single",{method:"POST",headers:new Headers,body:JSON.stringify({idatividade:e})}).then(e=>e.json()).then(t=>{var s,i,o=(i=t[0]).endereco,n=i.lat_ativo,l=i.lon_ativo,c=i.id_group,r=t.empresa.cidade,d=t.cliente.name_client,p=(r=t.cliente.endereco_cliente,t.cliente.cidade_cliente),u=t.cliente.cep_cliente,v=t.cliente.num_cliente,_=t.cliente.foto_cliente,m=t.cliente.phone_cliente;""!=r&&(r=r),""!=p&&(p=" , "+p),""!=v&&(v=" , "+v),""!=u&&(u=" , "+u),s=r+v+p+u;var g=t.tools.tools,f="";g.forEach(function(e){f+='<section class="year"><section><ul><li><small>'+e.patrimonio+"- "+e.descricao+"</small></li></ul></section></section>"}),$$("#info_tool").html(f);var h=t.config;$$("#nome_empresa_at").html("<strong>"+d+"</strong>"),$$("#end_empresa_at").html('<i style="color:#9c9c9c;" class="fa fa-map-marker"></i> '+s),$$("#phone_cliente").html(m),$$("#foto_empresa").attr("src",_),o=""!=o?""!=(o=o)?'<a class="open_map" style="color:#000;"> <i style="font-size:14px;margin-right: 5px;" class="ion-ios-pin" ></i>'+o+"</a>":o:"N/A";i.id;var b,x=i.status_,y=i.id,w=i.id_funcionario,k=i.id_form,C=i.qrcode,S=i.priority,T=i.info_extra,A=(_=i.foto_cliente,""),j=i.local_ativo;j=null==j?"N/A":j,b=null==C?"N/A":C+" - "+i.descricao,generateForm(k,x,e,h,c),$("#titulo_atividade").html("<strong>"+i.desc_service+"</strong>"),$("#ativo_equipamento").html("<strong>"+b+"</strong>"),$("#local_ativo").html('<strong class="open_map_ativo">'+j+"</strong>"),$("#data_atividade").html("<strong>"+i.br_start+"</strong>"),$("#tempo_estimado").html("<strong>"+i.est_time+"</strong>"),$("#prioridade_").html("<strong>"+S+"</strong>"),$("#info_extra").html("<strong>"+T+"</strong>"),"Pendente"==x&&($$(".status_activity").html('<div class="content status_pendente"><span class="">'+x+"</span></div>"),$$(".right_tab_act").html(""),$$("#btn_action_service").html('<button id="comecar" class="button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>')),"Em Andamento"==x&&($$(".status_activity").html('<div class="content status_andamento"><span class="">'+x+"</span></div>"),$$("#btn_action_service").html(""),setTimeout(function(){window.animatelo.bounceIn(".right_tab_act")},300),A='<div class="col-100"><button id="finalizar" class="button btn_status_finalizado change_status_service scaleffect no-active-state">Finalizar Atividade</button></div>',$$("#box_finish_action").html(A),window.animatelo.bounceIn("#box_finish_action")),"Finalizado"==x&&($$(".status_activity").html('<div class="content status_finalizado"><span class="">'+x+"</span></div>"),"a"==a||"g"==a||"r"==a?1==h.flow_approve&&($$("#box_finish_action").show(),$$("#box_finish_action").html('<button style="float: left;width: 48%;margin-right: 5px;font-size: 16px;line-height: inherit;" id="concluido" class="btn status_approve  button btn_approve change_status_approve scaleffect">Aprovar</button><button id="reprovado" style="float: left;width: 48%;margin-right: 5px;font-size: 16px;line-height: inherit;" class="btn btn_repprove status_repprove button  change_status_approve scaleffect">Reprovar</button>'),$$("#box_finish_action").show()):($$("#box_save_checklist").hide(),$$("#box_finish_action").hide(),$$("#box_action_sigcli").hide())),"Concluído"==x&&($$(".status_activity").html('<div class="content status_concluido"><span class="">'+x+"</span></div>"),$$("#box_save_checklist").html(""),$$("#box_save_checklist").hide(),$$("#box_finish_action").html('<div style="text-align:center"><img style="width: 110px;" src="img/Checkmark.svg"/><h2>Atividade Concluída</h2></div>'),$$("#box_save_checklist").hide()),setTimeout(function(){$$(".scaleffect").on("touchstart",function(){$$(this).addClass("box-scale")}),$$(".scaleffect").on("touchend",function(){$$(this).removeClass("box-scale")}),$$(".open_map_ativo").on("click",function(e){e.preventDefault(),-1!=navigator.platform.indexOf("iPhone")||-1!=navigator.platform.indexOf("iPad")||-1!=navigator.platform.indexOf("iPod")?window.open("maps://maps.google.com/maps?daddr="+n+","+l+"&amp;ll="):window.open("https://maps.google.com/maps?daddr="+n+","+l+"&amp;ll=")}),$$(".change_status_service").on("click",function(e){e.preventDefault();let t=this.id,a=Utils.userData();a.id,a.type;altera_status(y,t,w,k,h,c,i)}),$$(".change_status_approve").on("click",function(t){t.preventDefault();let a=this.id;var s;if("concluido"==a&&(s="Aprovar a Atividade",1==h.flow_approve)){var i=$$(".has_sign_tec").attr("src");if(null==i||"undefined"==i)return void app.toast.create({text:"Obrigatório Assinatura Responsável Técnico!",closeTimeout:2e3,cssClass:"error_toast"}).open()}if("reprovado"==a){s="Reprovar a Atividade";var o=app.sheet.create({el:".open_modal_approve",swipeToClose:!1,swipeToStep:!1,backdrop:!0,closeByBackdropClick:!1,closeByOutsideClick:!1});o.open();'<li class="item-content item-input"><div class="item-inner"><div class="item-input-wrap"><br><textarea id="reprove_message_" cols="30" rows="10" placeholder="Digite sua Justificativa"></textarea><br><button class="btn scaleffect no-active-state button btn_confirma_reprove">Confirmar</button><br><br><button style="background:#F44336" class="btn button scaleffect no-active-state close_manual" id="close_manual" >Cancelar</button></div></div></li>',$$("#box_noapprove").html('<li class="item-content item-input"><div class="item-inner"><div class="item-input-wrap"><br><textarea id="reprove_message_" cols="30" rows="10" placeholder="Digite sua Justificativa"></textarea><br><button class="btn scaleffect no-active-state button btn_confirma_reprove">Confirmar</button><br><br><button style="background:#F44336" class="btn button scaleffect no-active-state close_manual" id="close_manual" >Cancelar</button></div></div></li>'),$$(".close_manual").on("click",function(e){e.preventDefault(),o.close()}),$$(".btn_confirma_reprove").on("click",function(t){t.preventDefault();var s=$$("#reprove_message_").val();fetch(current_path+"/view/repprove_event",{method:"POST",headers:new Headers,body:JSON.stringify({repprove_message:s,eventID:y,acao:a,id_funcionario:w})}).then(e=>e.json()).then(t=>{if("SUCCESS"==t.status){"reprovado"==a?($$("#btn_action_service").html('<button id="comecar" class="btn button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '),$$("#box_finish_action").html("")):$$("#box_finish_action").html(""),o.close();let t=Utils.userData();t.id,t.type;$$("#box_sig_cli").html(""),get_info_gerais(e),call_open_events(),call_open_events_groups(c)}}).catch(e=>console.log(e))})}else app.dialog.confirm("Você tem certeza que deseja "+s+" ?","Confirmação ",function(){fetch(current_path+"/view/alteraStatus",{method:"POST",headers:new Headers,body:JSON.stringify({eventID:y,acao:a,id_funcionario:w,id_form:k})}).then(e=>e.json()).then(t=>{if("SUCCESS"==t.status){if("concluido"==a)$$("#btn_action_service").html(""),$$("#status_servico").html('<div class="content status_concluido"><span class="status_concluido ">Concluído</span></div>'),app.toast.create({text:"Salvo com Sucesso",closeTimeout:2e3,cssClass:"success_toast"}).open(),$$("#box_sig_cli").html("");"reprovar"==a&&($$("#btn_action_service").html('<button id="comecar" class="button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '),$$("#box_sig_cli").html(""));let t=Utils.userData();t.id,t.type;$$("#box_sig_cli").html(""),call_open_events(),get_info_gerais(e),call_open_events_groups(c)}}).catch(e=>console.log(e))})})},500)}).catch(e=>console.log(e))}function start_get_location(e,t,a,s,i,o,n){app.dialog.progress("Buscando sua localização! Aguarde 15s"),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var t=e.coords.latitude,a=e.coords.longitude;$$("#gps_lat").val(t),$$("#gps_lon").val(a),plot_map(t,a),app.dialog.close()},function(l){app.dialog.close();switch(l.code){case 1:console.error("User denied the request for Geolocation."),app.dialog.alert("Ops!Parece que você não habilitou as configurações de Geolocalização  ","Erro");break;case 2:console.error("Location information is unavailable."),gps_try(e,t,a,s,i,o,"Não foi possível encontrar sua localização",n);break;case 3:console.error("The request to get user location timed out."),gps_try(e,t,a,s,i,o,"Tempo esgotado.Não foi possível encontrar sua localização",n);break;case 4:gps_try(e,t,a,s,i,o,"Não foi possível encontrar sua localização",n),console.error("An unknown error occurred.")}},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}function gps_try(e,t,a,s,i,o,n,l){var c=app.sheet.create({el:".qr_manual_Tag",swipeToClose:!1,swipeToStep:!1,backdrop:!0,closeByBackdropClick:!1,closeByOutsideClick:!1});c.open();var r;r='<div class="item-inner"><div class="item-input-wrap"><div class="block-title tag_invalid_txt" style="text-align: center;font-size:17px;color: #F44336;overflow: inherit;">'+n+'</div><div class="row" style="margin-top: 10px;" ><a style="width:100%;" class="btn confirm_gps_manual">Confirmar assim mesmo</a></div><div class="row" style="margin-top: 10px;" ><a style="width:100%;" class="btn try_gps_again">Tentar Novamenta</a></div><div class="row" style="margin-top: 10px;" ><a style="background:#F44336;width: 100%;" class="btn close_manual" id="close_manual" >Cancelar</a></div></div></div>',$$("#box_not_found_tag").html(r),$$(".try_gps_again").on("click",function(c){c.preventDefault(),start_get_location(e,t,a,s,i,o,n,l)}),$$(".confirm_gps_manual").on("click",function(r){r.preventDefault(),gps_signin_off(e,t,a,s,i,o,n,c,l)}),$$(".close_manual").on("click",function(e){e.preventDefault(),c.close(),setTimeout(function(){$$(".back").click()},1e3)})}function gps_signin_off(e,t,a,s,i,o,n,l,c){let r=Utils.userData();null!=r&&"null"!=r||app.views.main.router.navigate({name:"sign-in"});var d=r.id,p=(r.type,c.det_info);app.dialog.confirm(n,"Ops! ",function(){fetch(current_path+"/controller/checkin-gps",{method:"POST",headers:new Headers,body:JSON.stringify({IdUser:d,eventID:t,gps_lat:0,gps_lon:0})}).then(e=>e.json()).then(e=>{"SUCCESS"==e.status?(app.preloader.hide(),app.toast.create({text:"Registrado com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),$$("#gps_lat").val(""),$$("#gps_lon").val(""),console.log("10"),$$("#box_sig_cli").html(""),get_info_gerais(t),call_open_events(),call_open_events_groups(p),l.close(),setTimeout(function(){app.views.current.router.back(),$$(".back").click()},1e3)):app.toast.create({text:"Erro ao registrar localização!",closeTimeout:2e3,cssClass:"error_toast"}).open()}).catch(e=>console.log(e))})}var map;function plot_map(e,t){null==map?(map=L.map("map_atividade").setView([e,t],16),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(map),L.marker([e,t]).addTo(map).bindPopup("Estou aqui!").openPopup()):(map.off(),map.remove(),map=L.map("map_atividade").setView([e,t],16),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(map),L.marker([e,t]).addTo(map).bindPopup("Estou aqui!").openPopup())}function qr_code_start(e,t,a,s,i,o,n,l){const c=new Html5Qrcode("qr-reader",!0);open_camera_qr_sign(e,t,a,s,i,c,o,n,l),$$(".stopscanerios").click(function(){c.stop().then(e=>{console.log("QR Code scanning stopped."),c.clear()}).catch(e=>{console.log("Unable to stop scanning.")})}),$$(".startcam").click(function(){const c=new Html5Qrcode("qr-reader",!0);open_camera_qr_sign(e,t,a,s,i,c,o,n,l)}),$$(".back-qr").on("click",function(e){e.preventDefault(),c.stop().then(e=>{console.log("QR Code scanning stopped."),c.clear()}).catch(e=>{console.log("Unable to stop scanning.")}),app.views.current.router.back()})}function qr_info(){let e=Utils.userData();null!=e&&"null"!=e||app.views.main.router.navigate({name:"sign-in"});var t=e.id,a=e.type;null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});const s=new Html5Qrcode("qr-reader",!0);open_camera_qr_info(s),$$(".stopscanerios").click(function(){s.stop().then(e=>{console.log("QR Code scanning stopped."),s.clear()}).catch(e=>{console.log("Unable to stop scanning.")})}),$$(".startcam").click(function(){open_camera_qr_info(s)}),$$(".back-qr").on("click",function(e){e.preventDefault(),s.stop().then(e=>{console.log("QR Code scanning stopped."),s.clear()}).catch(e=>{console.log("Unable to stop scanning.")}),app.views.current.router.back()}),$$(".search_tag").on("click",function(e){e.preventDefault();var i=$$("#qr_tag_input").val();null!=i&&"null"!=i&&""!=i?fetch(current_path+"/view/get_qr_info",{method:"POST",headers:new Headers,body:JSON.stringify({IdUser:t,type:a,qrCodeMessage:i})}).then(e=>e.json()).then(e=>{"SUCCESS"==e.status?(app.preloader.hide(),s.stop().then(e=>{console.log("QR Code scanning stopped."),s.clear()}).catch(e=>{console.log("Unable to stop scanning.")}),app.toast.create({text:"Encontrado com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),setTimeout(function(){app.views.main.router.navigate("/info_ativo/"+i)},100)):app.toast.create({text:"Ativo não encontrado!",closeTimeout:2e3,cssClass:"error_toast"}).open()}).catch(e=>console.log(e)):app.toast.create({text:"Digite a identificação!",closeTimeout:2e3,cssClass:"error_toast"}).open()})}function open_camera_qr_info(e){let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});var a=t.id,s=t.type;null!=a&&"null"!=a||app.views.main.router.navigate({name:"sign-in"});app.sheet.create({el:".open_manual_Tag",swipeToClose:!1,swipeToStep:!1,backdrop:!0,closeByBackdropClick:!1,closeByOutsideClick:!1});Html5Qrcode.getCameras().then(t=>{const i={fps:10,qrbox:250},o={facingMode:"environment"};if(t&&t.length){t[0].id;e.start(o,i,t=>{const i=new Audio;i.src="voice/pi.wav",i.play(),e.stop().then(i=>{$$("#qr-reader-results").html(t),e.clear(),fetch(current_path+"/view/get_qr_info",{method:"POST",headers:new Headers,body:JSON.stringify({IdUser:a,type:s,qrCodeMessage:t})}).then(e=>e.json()).then(e=>{"SUCCESS"==e.status?(app.preloader.hide(),app.toast.create({text:"Encontrado com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),setTimeout(function(){app.views.main.router.navigate("/info_ativo/"+t)},10)):app.toast.create({text:"Ativo não encontrado!",closeTimeout:2e3,cssClass:"error_toast"}).open()}).catch(e=>console.log(e))}).catch(e=>{})},e=>{}).catch(e=>{})}}).catch(e=>{})}function open_camera_qr_sign(e,t,a,s,i,o,n,l,c){var r=app.sheet.create({el:".qr_manual_Tag",swipeToClose:!1,swipeToStep:!1,backdrop:!0,closeByBackdropClick:!1,closeByOutsideClick:!1});Html5Qrcode.getCameras().then(d=>{const p={fps:10,qrbox:250},u={facingMode:"environment"};if(d&&d.length){d[0].id;o.start(u,p,d=>{if($("#qr-shaded-region").html('<div style="position: absolute;background-color: rgb(171 236 96);width: 40px;height: 5px;top: -5px;left: 0px;"></div><div style="position: absolute;background-color: #8bc34a;width: 40px;height: 5px;top: -5px;right: 0px;"></div><div style="position: absolute;background-color: #8bc34a;width: 40px;height: 5px;top: 255px;left: 0px;"></div><div style="position: absolute;background-color: #8bc34a;width: 40px;height: 5px;top: 255px;right: 0px;"></div><div style="position: absolute;background-color: #8bc34a;width: 5px;height: 45px;top: -5px;left: -5px;"></div><div style="position: absolute;background-color: #8bc34a;width: 5px;height: 45px;top: 215px;left: -5px;"></div><div style="position: absolute;background-color: #8bc34a;width: 5px;height: 45px;top: -5px;right: -5px;"></div><div style="position: absolute;background-color: #8bc34a;width: 5px;height: 45px;top: 215px;right: -5px;"></div>'),d==s){const s=new Audio;return s.src="voice/pi.wav",s.play(),void o.stop().then(s=>{if($$("#qr-reader-results").html(d),o.clear(),"offline"==(navigator.onLine?"online":"offline")){var r=db.transaction(["tb_single"],"readwrite").objectStore("tb_single"),p=r.get(e);return p.onerror=function(e){},void(p.onsuccess=function(s){var o=p.result;o.qr_checkin=1;var d=r.put(o);d.onerror=function(e){app.toast.create({text:"Erro ao registrar o QRCode!",closeTimeout:2e3,cssClass:"error_toast"}).open()},d.onsuccess=function(s){altera_status_off(e,t,a,i,n,l,c),setTimeout(function(){$$(".back").click()},1e3)}})}fetch(current_path+"/controller/checkin-qrcode",{method:"POST",headers:new Headers,body:JSON.stringify({IdUser:a,eventID:e,qrCodeMessage:d})}).then(e=>e.json()).then(s=>{"SUCCESS"==s.status?(app.preloader.hide(),app.toast.create({text:"Registrado com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),altera_status(e,t,a,i,n,l,c),setTimeout(function(){$$(".back").click()},1e3)):app.toast.create({text:"Erro ao registrar QrCode!",closeTimeout:2e3,cssClass:"error_toast"}).open()}).catch(e=>console.log(e))}).catch(e=>{console.log("Unable to stop scanning.")})}{$$("#qr-reader-results").html(d);const p=new Audio;p.src="voice/pi.wav",p.play(),o.stop().then(e=>{console.log("fechei depois de achar "),o.clear()}),r.open();'<li class="item-content item-input"><div class="item-inner"><div class="item-input-wrap"><div class="block-title tag_invalid_txt" style="text-align: center;font-size: 25px;color: #F44336;overflow: inherit;">TAG INVÁLIDA</div><p style="text-align:center;font-size: 11px;" >TAG não corresponde com a atividades </p><br><p style="text-align:center;" >Deseja digitar manualmente a Tag para Iniciar a Atividade ? </p><br><input type="text" name="tag_manual" id="tag_manual" style="text-transform: uppercase;" ><div class="row" style="margin-top: 10px;" ><a style="width:100%;" class="btn btn_confirma_manual">Confirmar</a></div><div class="row" style="margin-top: 10px;" ><a style="background:#F44336;width: 100%;" class="btn close_manual" id="close_manual" >Cancelar</a></div></div></div></li>',$$("#box_not_found_tag").html('<li class="item-content item-input"><div class="item-inner"><div class="item-input-wrap"><div class="block-title tag_invalid_txt" style="text-align: center;font-size: 25px;color: #F44336;overflow: inherit;">TAG INVÁLIDA</div><p style="text-align:center;font-size: 11px;" >TAG não corresponde com a atividades </p><br><p style="text-align:center;" >Deseja digitar manualmente a Tag para Iniciar a Atividade ? </p><br><input type="text" name="tag_manual" id="tag_manual" style="text-transform: uppercase;" ><div class="row" style="margin-top: 10px;" ><a style="width:100%;" class="btn btn_confirma_manual">Confirmar</a></div><div class="row" style="margin-top: 10px;" ><a style="background:#F44336;width: 100%;" class="btn close_manual" id="close_manual" >Cancelar</a></div></div></div></li>'),$$("#tag_manual").focus(),document.getElementById("tag_manual").style.border="1px solid #f44336",$$(".close_manual").on("click",function(e){e.preventDefault(),r.close()}),$$(".btn_confirma_manual").on("click",function(o){o.preventDefault();var p=$$("#tag_manual").val();if(""==(p=p.toUpperCase()))return app.toast.create({text:"Campo Obrigatório",closeTimeout:2e3,cssClass:"error_toast"}).open(),$$("#tag_manual").focus(),document.getElementById("tag_manual").style.border="1px solid #f44336",!1;window.animatelo.bounceIn(".tag_invalid_txt"),document.getElementById("tag_manual").style.border="1px solid #d8d8d8",p!=s&&"NA"!=p||($$("#qr-reader-results").html(p),r.close(),fetch(current_path+"/controller/checkin-qrcode",{method:"POST",headers:new Headers,body:JSON.stringify({IdUser:a,eventID:e,qrCodeMessage:d})}).then(e=>e.json()).then(s=>{"SUCCESS"==s.status?(app.preloader.hide(),app.toast.create({text:"Registrado com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),altera_status(e,t,a,i,n,l,c),setTimeout(function(){$$(".back").click()},1e3)):app.toast.create({text:"Erro ao registrar localização!",closeTimeout:2e3,cssClass:"error_toast"}).open()}).catch(e=>console.log(e)))})}},e=>{}).catch(e=>{})}}).catch(e=>{})}function get_tag_id(e,t,a,s,i,o,n,l){if(e==i)altera_status(t,a,s,o,n,l,det_info);else{open_manual_Tag.open();'<li class="item-content item-input"><div class="item-inner"><div class="item-input-wrap"><div class="block-title"  style="text-align: center;font-size: 25px;color: #F44336;overflow: inherit;">TAG INVÁLIDA</div><p style="text-align:center;font-size: 11px;" >TAG não corresponde com as atividades da Embarcação</p><br><p style="text-align:center;" >Deseja digitar manualmente a Tag para Iniciar a Atividade ? </p><br><input type="text" name="tag_manual" id="tag_manual" style="text-transform: uppercase;" ><button class="button btn_confirma_manual">Confirmar</button></div></div></li>',$$("#box_not_found").html('<li class="item-content item-input"><div class="item-inner"><div class="item-input-wrap"><div class="block-title"  style="text-align: center;font-size: 25px;color: #F44336;overflow: inherit;">TAG INVÁLIDA</div><p style="text-align:center;font-size: 11px;" >TAG não corresponde com as atividades da Embarcação</p><br><p style="text-align:center;" >Deseja digitar manualmente a Tag para Iniciar a Atividade ? </p><br><input type="text" name="tag_manual" id="tag_manual" style="text-transform: uppercase;" ><button class="button btn_confirma_manual">Confirmar</button></div></div></li>'),$$("#tag_manual").focus(),document.getElementById("tag_manual").style.border="1px solid #f44336",$$(".close_manual").on("click",function(e){e.preventDefault(),open_manual_Tag.close(),device_type=deviceOS(),"iphone"!=device_type?start_camera_open(t,a,s,i,o,n,l):(qr_code_start(t,a,s,i,o,n,l),$$("#camera_box").hide())}),$$(".btn_confirma_manual").on("click",function(e){e.preventDefault();var c=$$("#tag_manual").val();if(""==c)return app.toast.create({text:"Campo Obrigatório",closeTimeout:2e3,cssClass:"error_toast"}).open(),$$("#tag_manual").focus(),document.getElementById("tag_manual").style.border="1px solid #f44336",!1;document.getElementById("tag_manual").style.border="none",get_tag_id(c,t,a,s,i,o,n,l)})}}function altera_status(e,t,a,s,i,o,n){let l=Utils.userData();null!=l&&"null"!=l||app.views.main.router.navigate({name:"sign-in"});let c=l.id,r=l.id,d=l.type;var p="",u="",v="",_=i,m=o,g=n.start_lat,f=n.id,h=n.qrcode;n.qr_checkin;if("comecar"==t)if("Iniciar Atividade",1==_.geo_location){if(""==g)return 0==_.qr_check_in?void app.views.main.router.navigate("/gps-signin/0/"+f+"/"+t+"/"+r+"/"+h+"/"+s+"/"+i+"/"+o+"/"+n):void app.views.main.router.navigate("/gps-signin/1/"+f+"/"+t+"/"+r+"/"+h+"/"+s+"/"+i+"/"+o+"/"+n);if(1==_.qr_check_in)return void app.views.main.router.navigate("/qr-signin/"+f+"/"+t+"/"+r+"/"+h+"/"+s+"/"+i+"/"+o+"/"+n)}else if(1==_.qr_check_in)return void app.views.main.router.navigate("/qr-signin/"+f+"/"+t+"/"+r+"/"+h+"/"+s);if("finalizar"==t&&"Enviar Aprovação","cancelar"==t&&"Cancelar Atividade","comecar"!=t&&1==_.signature_exec){if(null==(u=$$(".has_sign_rest_exec").attr("src"))||"undefined"==u)return void app.toast.create({text:"Obrigatório Assinatura Responsável Execução!",closeTimeout:2e3,cssClass:"error_toast"}).open();if(1==_.signature&&(null==(p=$$(".has_sign_client").attr("src"))||"undefined"==p))return void app.toast.create({text:"Obrigatório Assinatura Inspetor",closeTimeout:2e3,cssClass:"error_toast"}).open()}if("concluido"==t)if(1==_.flow_approve){if(null==(v=$$(".has_sign_tec").attr("src"))||"undefined"==v)return void app.toast.create({text:"Obrigatório Assinatura Responsável Técnico!",closeTimeout:2e3,cssClass:"error_toast"}).open()}else $$("#box_finish_action").html("");if("finalizar"==t)if(1==_.flow_approve){if(!(console.log("type - "+d),"a"!=d&&"r"!=d&&"g"!=d||null!=(v=$$(".has_sign_tec").attr("src"))&&"undefined"!=v))return void app.toast.create({text:"Obrigatório Assinatura Responsável Técnico!",closeTimeout:2e3,cssClass:"error_toast"}).open()}else t="concluido";fetch(current_path+"/view/alteraStatus",{method:"POST",headers:new Headers,body:JSON.stringify({eventID:e,acao:t,id_funcionario:c,id_form:s})}).then(e=>e.json()).then(i=>{status=i.status;var o="";if("comecar"==t)$$("#btn_action_service").html(""),$$("#status_servico").html('<div class="content status_andamento"><span class="">Em Andamento</span></div>'),$$(".status_activity").html('<div class="content status_andamento"><span class="">Em Andamento</span></div>'),$$(".right_tab_act").html('<a href="#tab-2" class="submit-btn tab-link"><img src="assets/img/icons/arrow.png" alt=""></a>'),setTimeout(function(){$$("#box_sig_cli").html(""),call_open_events(),call_open_events_groups(m),get_info_gerais(e)},200),o='<div class="col-100"><button id="finalizar" class="button btn_status_finalizado change_status_service scaleffect no-active-state">Finalizar Atividade</button></div>',$$("#box_finish_action").html(o),app.toast.create({text:"Salvo com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),setTimeout(function(){$$(".change_status_service").on("click",function(e){}),$$(".change_status_approve").on("click",function(t){t.preventDefault();let i=this.id;var o;if("concluido"==i)if(o="Aprovar a Atividade",1==_.flow_approve){var n=$$(".has_sign_tec").attr("src");if(null==n||"undefined"==n)return void app.toast.create({text:"Obrigatório Assinatura Responsável Técnico!",closeTimeout:2e3,cssClass:"error_toast"}).open()}else $$("#box_finish_action").html("");if("reprovado"==i){o="Reprovar a Atividade";var l=app.sheet.create({el:".open_modal_approve",swipeToClose:!1,swipeToStep:!1,backdrop:!0,closeByBackdropClick:!1,closeByOutsideClick:!1});l.open();var c="";c='<div class="item-inner"><div class="item-input-wrap"><br><textarea id="reprove_message_" cols="30" rows="10" placeholder="Digite sua Justificativa"></textarea><br><button class="btn scaleffect no-active-state button btn_confirma_reprove">Confirmar</button><br><br><button style="background:#F44336" class="btn button scaleffect no-active-state close_manual" id="close_manual" >Cancelar</button></div></div>'+$$("#box_noapprove").html(c),$$(".close_manual").on("click",function(e){e.preventDefault(),l.close()}),$$(".btn_confirma_reprove").on("click",function(t){t.preventDefault();var s=$$("#reprove_message_").val();fetch(current_path+"/view/repprove_event",{method:"POST",headers:new Headers,body:JSON.stringify({repprove_message:s,eventID:e,acao:i,id_funcionario:a})}).then(e=>e.json()).then(t=>{if("SUCCESS"==t.status){console.log("the_status concluido - "+i),"reprovado"==i?($$("#btn_action_service").html('<button id="comecar" class="btn button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '),$$("#box_finish_action").html("")):$$("#box_finish_action").html(""),l.close();let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id,t.type;$$("#box_sig_cli").html(""),get_info_gerais(e),call_open_events(),call_open_events_groups(m)}}).catch(e=>console.log(e))})}else app.dialog.confirm("Você tem certeza que deseja "+o+" ?","Confirmação ",function(){fetch(current_path+"/view/alteraStatus",{method:"POST",headers:new Headers,body:JSON.stringify({eventID:e,acao:i,id_funcionario:a,id_form:s})}).then(e=>e.json()).then(t=>{if("SUCCESS"==t.status){if("concluido"==i)$$("#btn_action_service").html(""),$$("#status_servico").html('<div class="content status_concluido"><span class="status_concluido ">Concluído</span></div>'),app.toast.create({text:"Salvo com Sucesso",closeTimeout:2e3,cssClass:"success_toast"}).open();"reprovar"==i&&($$("#btn_action_service").html('<button id="comecar" class="button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '));let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id,t.type;$$("#box_sig_cli").html(""),$$("#box_finish_action").remove(),call_open_events(),get_info_gerais(e),call_open_events_groups(m)}}).catch(e=>console.log(e))})})},500);else if("Em Andamento"==t){$$("#status_servico").html('<div class="content status_andamento"><span class="">Em Andamento</span></div>'),$$(".status_activity").html('<div class="content status_andamento"><span class="">Em Andamento</span></div>'),$$(".right_tab_act").html('<a href="#tab-2" class="submit-btn tab-link"><img src="assets/img/icons/arrow.png" alt=""></a>'),o='<div class="col-100"><button id="finalizar" class="button btn_status_finalizado change_status_service scaleffect no-active-state">Finalizar Atividade</button></div>',$$("#box_finish_action").html(o),setTimeout(function(){$$("#box_sig_cli").html(""),call_open_events(),call_open_events_groups(m),get_info_gerais(e)},200),app.toast.create({text:"Salvo com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open()}else if("cancelar"==t){$$("#btn_action_service").html('<button class="button btn_status_cancelado">Cancelado</button>'),$$("#status_servico").html('<div class="content status_cancelado"><span class="">Cancelado</span></div> '),$$(".status_activity").html('<div class="content status_cancelado"><span class="">Cancelado</span></div> '),open_manual_Tag.close();let e=Utils.userData();null!=e&&"null"!=e||app.views.main.router.navigate({name:"sign-in"});e.id,e.type;app.toast.create({text:"Salvo com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open()}else if("finalizar"==t){let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id;let i=t.type;var n="",l="";if(1==_.signature_exec){if(null==(l=$$(".has_sign_rest_exec").attr("src"))||"undefined"==l)return void app.toast.create({text:"Obrigatório Assinatura Responsável Execução!",closeTimeout:2e3,cssClass:"error_toast"}).open();if(1==_.signature){if(null==(n=$$(".has_sign_client").attr("src"))||"undefined"==n)return void app.toast.create({text:"Obrigatório Assinatura Inspetor",closeTimeout:2e3,cssClass:"error_toast"}).open();"a"==i||"g"==i||"r"==i?$$("#box_finish_action").html('<button style="float:left;width:48%;margin-right:5px;font-size:16px;height:45px;" id="concluido" class="status_approve  button btn_approve change_status_approve scaleffect">Aprovar</button><button id="reprovado"  style="float:left;width:48%;font-size:16px;height:45px;" class="btn_repprove status_repprove button btn_status_reprovar change_status_approve scaleffect">Reprovar</button>'):$$("#box_finish_action").html(""),$$("#status_servico").html('<div class="content status_finalizado"><span class="">Finalizado</span></div>'),$$(".status_activity").html('<div class="content status_finalizado"><span class="">Finalizado</span></div>')}else"a"==i||"g"==i||"r"==i?$$("#box_finish_action").html('<button style="float: left;width:48%;margin-right:5px;font-size:16px;height:45px;" id="concluido" class="status_approve  button btn_approve change_status_approve scaleffect">Aprovar</button><button id="reprovado"  style="float:left;width:48%;font-size:16px;height:45px;" class="btn_repprove status_repprove button btn_status_reprovar change_status_approve scaleffect">Reprovar</button>'):$$("#box_finish_action").html(""),$$("#status_servico").html('<div class="content status_finalizado"><span class="">Finalizado</span></div>'),$$(".status_activity").html('<div class="content status_finalizado"><span class="">Finalizado</span></div>')}app.toast.create({text:"Salvo com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),$$("input,textarea,select").prop("disabled",!0),$$("#box_save_checklist").hide(),$$("#box_images_up").hide(),$$("#phone_cliente").prop("disabled",!1),$$("#zap_message").prop("disabled",!1),$$(".change_status_approve").on("click",function(t){t.preventDefault();let i=this.id;var o;if("concluido"==i&&(o="Aprovar a Atividade",1==_.flow_approve)){var n=$$(".has_sign_tec").attr("src");if(null==n||"undefined"==n)return void app.toast.create({text:"Obrigatório Assinatura Responsável Técnico!",closeTimeout:2e3,cssClass:"error_toast"}).open()}if("reprovado"==i){o="Reprovar a Atividade";var l=app.sheet.create({el:".open_modal_approve",swipeToClose:!1,swipeToStep:!1,backdrop:!0,closeByBackdropClick:!1,closeByOutsideClick:!1});l.open();'<li class="item-content item-input"><div class="item-inner"><div class="item-input-wrap"><br><textarea id="reprove_message_" cols="30" rows="10" placeholder="Digite sua Justificativa"></textarea><br><button class="btn scaleffect no-active-state button btn_confirma_reprove">Confirmar</button><br><br><button style="background:#F44336" class="btn button scaleffect no-active-state close_manual" id="close_manual" >Cancelar</button></div></div></li>',$$("#box_noapprove").html('<li class="item-content item-input"><div class="item-inner"><div class="item-input-wrap"><br><textarea id="reprove_message_" cols="30" rows="10" placeholder="Digite sua Justificativa"></textarea><br><button class="btn scaleffect no-active-state button btn_confirma_reprove">Confirmar</button><br><br><button style="background:#F44336" class="btn button scaleffect no-active-state close_manual" id="close_manual" >Cancelar</button></div></div></li>'),$$(".close_manual").on("click",function(e){e.preventDefault(),l.close()}),$$(".btn_confirma_reprove").on("click",function(t){t.preventDefault();var s=$$("#reprove_message_").val();fetch(current_path+"/view/repprove_event",{method:"POST",headers:new Headers,body:JSON.stringify({repprove_message:s,eventID:e,acao:i,id_funcionario:a})}).then(e=>e.json()).then(t=>{if("SUCCESS"==t.status){"reprovado"==i?($$("#btn_action_service").html('<button id="comecar" class="btn button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '),$$("#box_finish_action").html("")):$$("#box_finish_action").html(""),l.close();let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id,t.type;$$("#box_sig_cli").html(""),get_info_gerais(e),call_open_events(),call_open_events_groups(m)}}).catch(e=>console.log(e))})}else app.dialog.confirm("Você tem certeza que deseja "+o+" ?","Confirmação ",function(){fetch(current_path+"/view/alteraStatus",{method:"POST",headers:new Headers,body:JSON.stringify({eventID:e,acao:i,id_funcionario:a,id_form:s})}).then(e=>e.json()).then(t=>{if("SUCCESS"==t.status){if("concluido"==i)$$("#btn_action_service").html(""),$$("#status_servico").html('<div class="content status_concluido"><span class="status_concluido ">Concluído</span></div>'),app.toast.create({text:"Salvo com Sucesso",closeTimeout:2e3,cssClass:"success_toast"}).open();"reprovar"==i&&($$("#btn_action_service").html('<button id="comecar" class="button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '));let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id,t.type;$$("#box_sig_cli").html(""),get_info_gerais(e),call_open_events(),call_open_events_groups(m)}}).catch(e=>console.log(e))})}),$$("#box_sig_cli").html(""),get_info_gerais(e),call_open_events(),call_open_events_groups(m)}else if("concluido"==t){$$("#btn_action_service").html(""),$$("#box_save_checklist").html(""),$$("#status_servico").html('<div class="content status_concluido "><span class="">Concluído</span></div> '),$$(".status_activity").html('<div class="content status_concluido "><span class="">Concluído</span></div> ');let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id,t.type;app.toast.create({text:"Salvo com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),0==_.flow_approve&&$("#box_finish_action").html(""),$$("#box_sig_cli").html(""),get_info_gerais(e),call_open_events(),call_open_events_groups(m)}else"reprovar"==t&&($$("#btn_action_service").html('<button id="comecar" class="button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '),$$(".status_activity").html('<div class="content status_pendente"><span class="">Pendente</span></div> '),$$("#box_sig_cli").html(""),get_info_gerais(e),call_open_events(),call_open_events_groups(m))}).catch(e=>console.log(e))}function deviceOS(){var e=navigator.userAgent;return e.match(/Android/i)?"android":e.match(/webOS/i)?"webos":e.match(/iPhone/i)?"iphone":e.match(/iPod/i)?"ipod":e.match(/iPad/i)?"ipad":e.match(/Windows Phone/i)?"windows phone":e.match(/SymbianOS/i)?"symbian":!(!e.match(/RIM/i)&&!e.match(/BB/i))&&"blackberry"}function generateForm(e,t,a,s,i){$("#sjfb-fields").empty(),$.getJSON(current_path+"/view/sjfb-load-form?form_id="+e,function(i){if(i){var o=JSON.parse(i.conteudo_formulario),n="",l=0,c=0,r=1,d="",p="",u="";if(null==o||"null"==o);else{$("#box_sig_cli").append('<div class="text-center" ><h3 style="margin-bottom: 30px;">Assinaturas</h3></div>'),$.each(o,function(i,o){var c=o.type,_=o.label;d=c,p=_;var m=o.label.split("@");if(u=m[0],m[1],"signature_box"==d){let s=Utils.userData();null!=s&&"null"!=s||app.views.main.router.navigate({name:"sign-in"});s.id;let i=s.type;if("Concluído"==t)var g='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" class="box row js-signature-'+e+"-"+r+' " ><div class="col-100 text-center"></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+p+"</div>";else if("Finalizado"==t)if("Responsável Técnico"==u)if("a"==i||"g"==i||"r"==i)g='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" class="box row js-signature-'+e+"-"+r+' " ><div class="col-100 text-center"><a href="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" style="padding:5px;" class="item-link item-content link edit_tecnico" ><i class="fa fa-pencil-square-o" style="font-size: 16px;"></i>Assinar</a></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+p+"</div>";else g='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" class="box row js-signature-'+e+"-"+r+' " ><div class="col-100 text-center"></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+p+"</div>";else g='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" class="box row js-signature-'+e+"-"+r+' " ><div class="col-100 text-center"></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+p+"</div>";else if("Em Andamento"==t)if("Responsável Execução"==u)g='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" class="box row js-signature-'+e+"-"+r+' " ><div class="col-100 text-center"><a href="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" style="padding:5px;" class="item-link item-content link edit_resp_exec_sign" ><i class="fa fa-pencil-square-o" style="font-size: 16px;"></i>Assinar</a></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+p+"</div>";else if("Inspetor"==u)g='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" class="box row js-signature-'+e+"-"+r+' " ><div class="col-100 text-center"><a href="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" style="padding:5px;" class="item-link item-content link edit_client_sign" ><i class="fa fa-pencil-square-o" style="font-size: 16px;"></i>Assinar</a></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+p+"</div>";else if("Responsável Técnico"==u)if("a"==i||"g"==i||"r"==i)g='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" class="box row js-signature-'+e+"-"+r+' " ><div class="col-100 text-center"><a href="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" style="padding:5px;" class="item-link item-content link " ><i class="fa fa-pencil-square-o" style="font-size: 16px;"></i>Assinar</a></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+p+"</div><br>";else g='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" class="box row js-signature-'+e+"-"+r+' " ><div class="col-100 text-center"></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+p+"</div>";else g='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" class="box row js-signature-'+e+"-"+r+' " ><div class="col-100 text-center"></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+p+"</div>";else if("Responsável Técnico"==u)if("a"==i||"g"==i||"r"==i)g='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" class="box row js-signature-'+e+"-"+r+' " ><div class="col-100 text-center"><a href="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" style="padding:5px;" class="item-link item-content link " ><i class="fa fa-pencil-square-o" style="font-size: 16px;"></i>Assinar</a></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+p+"</div>";else g='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" class="box row js-signature-'+e+"-"+r+' " ><div class="col-100 text-center"></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+p+"</div>";else g='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" class="box row js-signature-'+e+"-"+r+' " ><div class="col-100 text-center"><a href="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+r+"/"+u+'" style="padding:5px;" class="item-link item-content link " ><i class="fa fa-pencil-square-o" style="font-size: 16px;"></i>Assinar</a></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+p+"</div>";$("#box_sig_cli").append(g)}$("#sjfb-fields").append(v(c,a,_,s));var f=$("#sjfb-fields .sjfb-field").last();if(f.find("label").text(o.label),o.choices){var h=f.find("label").text(u).prevObject[0].id,b=f.find("label").text(u).prevObject[0].id,x="",y="";$.each(o.choices,function(e,t){if("select"==c){var a="<option"+(s=t.sel?" selected":"")+">"+t.label+"</option>";f.find(".choices").append(a)}else if("radio"==c){var s=t.sel?" checked":"";"Sim"==t.label&&(x="fa fa-thumbs-up",y="yes_option"),"Não"==t.label&&(x="fa fa-thumbs-down",y="no_option"),"N/A"==t.label&&(x="fa fa-ban",y="na_option");a='<label for="radio-'+l+'" class="col-33"><input class="'+n+'" id="radio-'+l+'" type="radio" name="radio-'+h+'" '+s+' value="'+t.label+'" ><div class="front-end box '+y+' "><i class="'+x+'"></i></div></label>';f.find(".choices").append(a)}else if("checkbox"==c){s=t.sel?" checked":"",a='<label class="col-12 item-content"><div class="form-check mb-5 mr-5"><input class="form-check-input styled-checkbox '+n+' " id="ch_'+l+'" type="checkbox" name="checkbox-'+b+'[]"'+s+' value="'+t.label+'" ><label for="ch_'+l+'" class="form-check-label check-green ">'+t.label+"</label></div></label>";f.find(".choices").append(a)}l++,$(".img_file").removeAttr("required"),$(".img_file").removeAttr("required-choice")})}o.req&&("file"==c?f.find("input").prop("required",!1).removeClass("required-choice"):"text"==c?f.find("input").prop("required",!0).addClass("required-choice"):"textarea"==c?f.find("textarea").prop("required",!0).addClass("required-choice"):"select"==c?f.find("select").prop("required",!0).addClass("required-choice"):"radio"==c?f.find("input").prop("required",!0).addClass("required-choice"):"number"==c?f.find("input").prop("required",!0).addClass("required-choice"):"date"==c?f.find("input").prop("required",!0).addClass("required-choice"):"time"==c&&f.find("input").prop("required",!0).addClass("required-choice"),f.addClass("required-field")),r++}),setTimeout(function(){$(".calendar_date_time_check").click(function(e){e.preventDefault();var t=$(this).attr("id"),a=app.calendar.create({inputEl:t,timePicker:!1,dateFormat:"dd/mm/yyyy",on:{change:function(e,t,a,s,i){},dayClick:function(e,s,i,o,n){o<10&&(o="0"+o);var l=n+"/"+o+"/"+i;$$("#"+t).val(l),a.close()}}});a.open()}),$(".calendar_time_check").click(function(e){e.preventDefault();var t=$(this).attr("id"),a=app.picker.create({inputEl:t,rotateEffect:!0,cols:[{textAlign:"left",values:"01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23".split(" ")},{values:":".split(" ")},{values:"00 05 10 15 20 25 30 35 40 45 50 55".split(" ")}],on:{closed:function(e,s,i,o,n){e.value[0],e.value[2];var l=e.value[0]+e.value[1]+e.value[2];$$("#"+t).val(l),a.close()}}});a.open()})},200),$("#sjfb-fields").append('<div id="box_save_checklist" style="padding:10px;"><button style="width:100%;" type="submitt" class="scaleffect btn btn-primary save_check_list button">Salvar Atividades</button></div>'),$$(".scaleffect").on("touchstart",function(){$$(this).addClass("box-scale")}),$$(".scaleffect").on("touchend",function(){$$(this).removeClass("box-scale")}),"Finalizado"!=t&&"Concluído"!=t||(n="disabled",$("input,textarea,select").prop("disabled",!0),$("#box_save_checklist").hide(),$("#phone_cliente").prop("disabled",!1),$("#zap_message").prop("disabled",!1)),setTimeout(function(){!function(e,a){$.getJSON(current_path+"/view/get_atividade_result?IdFormulario="+e+"&IdEvento="+a,function(e){if(e)if("SUCCESS"==e.status){var a="";let _=Utils.userData();null!=_&&"null"!=_||app.views.main.router.navigate({name:"sign-in"});_.id;let m=_.type;for(var s=e.resp_atividade,i=0;i<s.length;i++){for(var o=s[i].campo,n=s[i].valor,l=document.getElementsByName(o),c=0;c<l.length;c++)n==l[c].value&&(o.indexOf("checkbox")>-1||$("input[name="+o+"]").val([n]));if($$('input[name="'+o+'[]"]').each(function(){var e=n.split(",");for(c=0;c<e.length;c++)e[c]==$(this).attr("value")&&$(this).prop("checked",!0)}),o.indexOf("js-signature")>-1){if($("."+o)[0]){var r=$("."+o)[0].id;if(n=null==n||"null"==n?"":n,"Concluído"==t)a='<div class="title-col-100" style="padding:10px"><h6 style="width: 100%;"><img class="has_sign_tec" id="'+r+'" src="'+n+'" alt="Assinatura"></h6></div>';else if("Finalizado"==t){if(r){var d=r.split("/");d=d.slice(-1).pop();var p="",u="";if("Responsável Técnico"==d)if("a"==m||"g"==m||"r"==m){if(""==n)var p="";else p='<img class="has_sign_tec" id="'+r+'" src="'+n+'" alt="Assinatura">';a='<div class="title-col-100" style="padding:10px"><a href="'+r+'" class="box-shadow tem-link item-content link " style="background: #d0d0d0;border-radius: 50%;float: right;padding: 8px;position: absolute;right: 10px;margin-top:-25px;"><i class="fa fa-pencil-square-o" style="font-size: 16px;color: #4c4c4c;"></i></a><h6 style="width: 100%;">'+p+"</h6></div>"}else{if(""==n)var p="";else p='<img class="has_sign_tec" id="'+r+'" src="'+n+'" alt="Assinatura">';a='<div class="title-col-100" style="padding:10px"><h6 style="width: 100%;">'+p+"</h6></div>"}else if("Responsável Execução"==d)if("a"==m||"g"==m||"r"==m){if(""==n)var p="";else p='<img class="has_sign_resp_exec" id="'+r+'" src="'+n+'" alt="Assinatura">';a='<div class="title-col-100" style="padding:10px"><a href="'+r+'" class="box-shadow tem-link item-content link " style="background: #d0d0d0;border-radius: 50%;float: right;padding: 8px;position: absolute;right: 10px;margin-top:-25px;"><i class="fa fa-pencil-square-o" style="font-size: 16px;color: #4c4c4c;"></i></a><h6 style="width: 100%;">'+p+"</h6></div>"}else{if(""==n)var p="";else p='<img class="has_sign_resp_exec" id="'+r+'" src="'+n+'" alt="Assinatura">';a='<div class="title-col-100" style="padding:10px"><h6 style="width: 100%;">'+p+"</h6></div>"}else if("a"==m||"g"==m||"r"==m){if(""==n)var u="";else u='<img class="has_sign_resp_client" id="'+r+'" src="'+n+'" alt="Assinatura">';a='<div class="title-col-100" style="padding:10px"><a href="'+r+'" class="box-shadow tem-link item-content link " style="background: #d0d0d0;border-radius: 50%;float: right;padding: 8px;position: absolute;right: 10px;margin-top:-25px;"><i class="fa fa-pencil-square-o" style="font-size: 16px;color: #4c4c4c;"></i></a><h6 style="width: 100%;">'+u+"</h6></div>"}else{if(""==n)var u="";else u='<img class="has_sign_resp_client" id="'+r+'" src="'+n+'" alt="Assinatura">';a='<div class="title-col-100" style="padding:10px"><h6 style="width: 100%;">'+u+"</h6></div>"}}}else if(r){var d=r.split("/");d=d.slice(-1).pop();var v="";if("Responsável Execução"==d){if(""==n)var v="";else v='<img class="has_sign_rest_exec" id="'+r+'" src="'+n+'" alt="Assinatura">';a='<div class="title-col-100" style="padding:10px"><a href="'+r+'" class="box-shadow tem-link item-content link " style="background: #d0d0d0;border-radius: 50%;float: right;padding: 8px;position: absolute;right: 10px;margin-top:-25px;"><i class="fa fa-pencil-square-o" style="font-size: 16px;color: #4c4c4c;"></i></a><h6 style="width: 100%;">'+v+"</h6></div>"}else if("Inspetor"==d){var u="";if(""==n)var u="";else u='<img class="has_sign_client" id="'+r+'" src="'+n+'" alt="Assinatura">';a='<div class="title-col-100" style="padding:10px"><a href="'+r+'" class="box-shadow tem-link item-content link " style="background: #d0d0d0;border-radius: 50%;float: right;padding: 8px;position: absolute;right: 10px;margin-top:-25px;"><i class="fa fa-pencil-square-o" style="font-size: 16px;color: #4c4c4c;"></i></a><h6 style="width: 100%;">'+u+"</h6></div>"}else{var u="";if(""==n)var u="";else u='<img class="has_sign_tec" id="'+r+'" src="'+n+'" alt="Assinatura">';a="a"==m||"g"==m||"r"==m?'<div class="title-col-100" style="padding:10px"><a href="'+r+'" class="box-shadow tem-link item-content link " style="background: #d0d0d0;border-radius: 50%;float: right;padding: 8px;position: absolute;right: 10px;margin-top:-25px;"><i class="fa fa-pencil-square-o" style="font-size: 16px;color: #4c4c4c;"></i></a><h6 style="width: 100%;">'+u+"</h6></div>":'<div class="title-col-100" style="padding:10px"><h6 style="width: 100%;">'+u+"</h6></div>"}}$("."+o).html(a)}}else o.indexOf("checkbox")>-1||(o.indexOf("select")>-1?$("select[name="+o+"]").val([n]):$("input[name="+o+"]").val([n]))}}else $("#no_item_message").show()})}(id_form,a)},150),$("input[type='text']").change(function(){this.value&&$(this).css("border","1px solid #dddfe1;")}),$(".save_check_list").on("click",function(t){if(t.preventDefault(),"offline"==(navigator.onLine?"online":"offline")){for(var s=document.getElementById("sjfb-sample").querySelectorAll("[required]"),i=(document.getElementById("check"),document.getElementById("output"),0);i<s.length;i++){if(!((t=s[i]).value.length>0)){var o=$("#"+t.id).offset().top-$(window).scrollTop();return $(".page-content").animate({scrollTop:o+20},600),$("#"+t.id).focus(),$("#"+t.id).blur(),$("#"+t.id).css("border","1px solid #f44336"),(toast_message=app.toast.create({text:"Campo obrigatório",closeTimeout:3e3,cssClass:"error_toast"})).open(),!1}$("#"+t.id).css("border","1px solid #e6e6e6")}var n=$("#sjfb-sample").serializeArray(),l=[];n.forEach(function(e){var t=l.filter(function(t,a){return t.name==e.name});if(t.length){var a=l.indexOf(t[0]);l[a].value=l[a].value.concat(e.value)}else"string"==typeof e.value&&(e.value=[e.value]),l.push(e)});var c,r=JSON.stringify(l),d=JSON.stringify(l),p=window.indexedDB.open("AnyInspect_dnata",3);p.onsuccess=function(t){c=p.result,setTimeout(function(){c.transaction("tb_save_event").objectStore("tb_save_event").openCursor().onsuccess=function(t){var s,i=t.target.result;if(i)if(i.value.at==a&&i.value.formID==e){console.log("e igual o id e form"),r=i.value,1;var o,n=i.key,l=c.transaction(["tb_save_event"],"readwrite").objectStore("tb_save_event");(o=l.get(n)).onerror=function(e){},o.onsuccess=function(e){var t=o.result;t.data=d;var a=l.put(t);a.onerror=function(e){app.toast.create({text:"Erro ao salvar!",closeTimeout:2e3,cssClass:"error_toast"}).open()},a.onsuccess=function(e){app.toast.create({text:"Salvo com Sucesso",closeTimeout:2e3,cssClass:"success_toast"}).open()}}}else 0,i.continue();else(o=window.indexedDB.open("AnyInspect_dnata",3)).onsuccess=function(t){s=o.result,setTimeout(function(){var t=s.transaction(["tb_save_event"],"readwrite").objectStore("tb_save_event").add({formID:e,at:a,data:r});t.onsuccess=function(e){e.target.result,s.close(),app.toast.create({text:"Erro ao salvar!",closeTimeout:2e3,cssClass:"success_toast"}).open()},t.onerror=function(e){app.toast.create({text:"Erro ao salvar!",closeTimeout:2e3,cssClass:"error_toast"}).open()}},200)}}},500)}}else{for(s=document.getElementById("sjfb-sample").querySelectorAll("[required]"),document.getElementById("check"),document.getElementById("output"),i=0;i<s.length;i++){if(!((t=s[i]).value.length>0)){o=$("#"+t.id).offset().top-$(window).scrollTop();return $(".page-content").animate({scrollTop:o+20},600),$("#"+t.id).focus(),$("#"+t.id).blur(),$("#"+t.id).css("border","1px solid #f44336"),(toast_message=app.toast.create({text:"Campo obrigatório",closeTimeout:3e3,cssClass:"error_toast"})).open(),!1}$("#"+t.id).css("border","1px solid #e6e6e6")}n=$("#sjfb-sample").serializeArray(),l=[];n.forEach(function(e){var t=l.filter(function(t,a){return t.name==e.name});if(t.length){var a=l.indexOf(t[0]);l[a].value=l[a].value.concat(e.value)}else"string"==typeof e.value&&(e.value=[e.value]),l.push(e)});r=JSON.stringify(l);$.ajax({method:"POST",url:current_path+"/controller/sjfb-save-result",data:{data:r,formID:e,at:a},dataType:"json",success:function(e){return"SUCCESS"==e.status?(app.toast.create({text:"Salvo com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),!1):(app.toast.create({text:"Erro ao salvar!",closeTimeout:2e3,cssClass:"error_toast"}).open(),!1)}})}})}}function v(t,a,s,i){c++;var o=e,n="";switch(n=1==i.image_single?'<div class="row block" style="text-align: center;margin-top: 10px;border-top: 1px solid #ececec;padding: 10px;"><div class="action_block col-33" ><a href="/comments-atividade/'+o+"-"+c+"/"+a+"/"+s+' " ><i class="fa fa-comment"></i>  </a></div><div class="action_block col-33"><a href="/imagem-atividade/'+o+"-"+c+"/"+a+"/"+s+' "><i class="fa fa-camera"></i> </a></div><div class="action_block col-33"><a href="/pa-atividade/'+o+"-"+c+"/"+a+"/"+s+' "><i class="fa fa-exclamation-triangle"></i> </a></div></div>':"Observações"==s?'<div class="row block" style="text-align: center;margin-top: 10px;border-top: 1px solid #ececec;padding: 10px;"><div class="action_block col-33" ><a href="/comments-atividade/'+o+"-"+c+"/"+a+"/"+s+' " ><i class="fa fa-comment"></i>  </a></div><div class="action_block col-33"><a href="/imagem-atividade/'+o+"-"+c+"/"+a+"/"+s+' "><i class="fa fa-camera"></i> </a></div><div class="action_block col-33"><a href="/pa-atividade/'+o+"-"+c+"/"+a+"/"+s+' "><i class="fa fa-exclamation-triangle"></i> </a></div></div>':'<div style="margin-top:20px;"></div>',t){case"text":return'<div id="sjfb-'+o+'" class="sjfb-field sjfb-text field_elements "><div class="block" ><label for="text-'+o+'" class="block-title" ></label></div><input name="text-'+o+"-"+c+'" class="form-control" type="text" id="text-'+o+"-"+c+'">'+n+"</div>";case"number":return'<div id="sjfb-'+o+'" class="sjfb-field sjfb-number field_elements "><div class="block" ><label for="number-'+o+'" class="block-title" ></label></div><input name="number-'+o+"-"+c+'" class="form-control" type="number" id="number-'+o+"-"+c+'">'+n+"</div>";case"date":return'<div id="sjfb-'+o+'" class="sjfb-field sjfb-date field_elements "><div class="block" ><label for="date-'+o+'" class="block-title" ></label></div><input name="date-'+o+"-"+c+'" class="form-control calendar_date_time_check" type="text" id="date-'+o+"-"+c+'">'+n+"</div>";case"time":return'<div id="sjfb-'+o+'" class="sjfb-field sjfb-time field_elements "><div class="block" ><label for="time-'+o+'" class="block-title" ></label></div><input name="time-'+o+"-"+c+'" class="form-control calendar_time_check" type="text" id="time-'+o+"-"+c+'">'+n+"</div>";case"textarea":return'<div id="sjfb-'+o+'" class="sjfb-field sjfb-textarea field_elements"><div class="block" ><label for="textarea-'+o+'" class="block-title"></label></div><textarea class="form-control form-control-lg" name="textarea-'+o+"-"+c+'"  id="textarea-'+o+"-"+c+'"></textarea>'+n+"</div>";case"select":return'<div id="sjfb-'+o+'" class="sjfb-field sjfb-select field_elements"><div class="block" ><label for="select-'+o+'" class="block-title"></label></div><select name="select-'+o+"-"+c+'" id="select-'+o+"-"+c+'" class="form-control choices choices-select"></select>'+n+"</div>";case"radio":return'<div id="sjfb-'+o+"-"+c+'" class="list sjfb-field sjfb-radio field_elements"><div class="block" ><label class="block-title"></label></div><li class="row choices choices-radio"></li>'+n+"</div>";case"checkbox":return'<div id="sjfb-'+o+"-"+c+'" class="list sjfb-field sjfb-checkbox field_elements"><div class="block" ><label class="block-title"></label></div><li class="choices choices-checkbox"></li>'+n+"</div>";case"section":return"Assinaturas"==s?'<div id="sjfb-section-'+o+'" class="sjfb-field sjfb-section required-field" style="background: #ffffff;color: #fff;margin-bottom: 0px;padding: 0;border-bottom: 0px;"><label class="block-title" style="color:#fff;"></label></div>':'<div id="sjfb-section-'+o+'" class="sjfb-field sjfb-section required-field" style="background:#d0d0d0;color:#333;margin-bottom: 0px;padding: 5px;border-bottom: 0px;"><label class="block-title" style="padding: 5px;"></label></div>';case"agree":return'<div id="sjfb-agree-'+o+'" class="sjfb-field sjfb-agree required-field"><input name="checkbox-'+o+"-"+c+'" type="checkbox" required><label class="block-title"></label></div>'}}})}function save_comment(e,t){var a=$$("#new_comment_element").val(),s="";""!=a?$.ajax({url:current_path+"/controller/upload_comment_form",type:"POST",dataType:"JSON",data:{id_booking:t,id_element:e,comment:a},success:function(e){var t=e.status,i=e.date_create;"SUCCESS"==t?(s+='<section class="year"><section><ul><li>'+a+"<br><small>"+i+"</small></li></ul></section></section>",$$("#comment_list").append(s),(toast_message=app.toast.create({text:"Salvo com Sucesso",closeTimeout:3e3,cssClass:"success_toast"})).open(),$$("#new_comment_element").val("")):(toast_message=app.toast.create({text:"Erro ao salvar",closeTimeout:3e3,cssClass:"error_toast"})).open()}}):(toast_message=app.toast.create({text:"Digite algum comentário",closeTimeout:3e3,cssClass:"error_toast"})).open()}function save_pa(e,t){var a=$$("#what_at").val(),s=$$("#why_at").val(),i=$$("#how_at").val(),o=$$("#resp_at").val(),n=$$("#where_at").val(),l=$$("#when_at").val(),c=$$("#cost_at").val();$.ajax({url:current_path+"/controller/update_pa",type:"POST",dataType:"JSON",data:{id_booking:t,id_element:e,what_at:a,why_at:s,how_at:i,resp_at:o,where_at:n,when_at:l,cost_at:c},success:function(e){status=e.status,"SUCCESS"==status?(toast_message=app.toast.create({text:"Salvo com Sucesso",closeTimeout:3e3,cssClass:"success_toast"})).open():(toast_message=app.toast.create({text:"Erro ao salvar",closeTimeout:3e3,cssClass:"error_toast"})).open()}})}window.addEventListener("beforeinstallprompt",e=>{if(!isIos()){var t=app.sheet.create({el:".install_app",swipeToClose:!1,swipeToStep:!1,backdrop:!0});console.log("👍","beforeinstallprompt",e),window.deferredPrompt=e,setTimeout(function(){t.open(),$$(".sign-in ").append('<div class="sheet-backdrop backdrop-in"></div>')},200)}}),$$(".install_android").on("click",function(e){e.preventDefault();app.sheet.create({el:".install_app",swipeToClose:!1,swipeToStep:!1,backdrop:!0,closeByBackdropClick:!0});const t=window.deferredPrompt;t?(t.prompt(),t.userChoice.then(e=>{console.log("👍","userChoice",e),window.deferredPrompt=null,$$(".sign-in .sheet-backdrop ").remove(),app.sheet.close(".install_app")})):console.log("The deferred prompt isnt available.")}),$$(".back-last").on("click",function(e){e.preventDefault(),app.views.current.router.back()}),navigator.permissions&&navigator.permissions.query?navigator.permissions.query({name:"geolocation"}).then(function(e){e.state;e.onchange=function(){console.log("geolocation permission state has changed to ",this.state)}}):navigator.geolocation&&console.log("sem permissao gps ainda");