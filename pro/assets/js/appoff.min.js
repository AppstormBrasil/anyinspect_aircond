"use strict";function call_open_events_off(){var e,t=window.indexedDB.open("AnyInspect_dnata",3);t.onsuccess=function(a){e=t.result,setTimeout(function(){$$("#open_list_approve").html(""),$$("#open_list_pending").html("");e.transaction("tb_events").objectStore("tb_events").openCursor().onsuccess=function(t){var a=t.target.result,s="",i="",n="",o="",l="",c=0,r="";if(a){if(r=a.value,"Pendente"==(o=a.value.status_)&&(n="list_status_pendente"),"Em Andamento"==o&&(o="Em Andamento",n="list_status_andamento","read"),"Cancelado"==o&&(o="Cancelado",n="list_status_cancelado","read"),"Deletado"==o&&(o="Deletado",n="list_status_deletado"),"Concluído"==o&&(o="Concluído",n="list_status_concluido","read"),"Finalizado"==o&&(n="list_status_finalizado","read"),c=r.total_groups,r.desc_service.length>31)var d=r.desc_service.substring(0,28)+"...";else d=r.desc_service;l=c>1?"/atividade-grupo/"+r.id_group:"/atividade/"+r.id,"Finalizado"==o&&(s+='<div class="patient-widget"><div class="patient-top-details"><div><span class="invoice-id"><strong>'+r.br_start+'</strong></span></div><div><span class="date-col '+n+'">'+o+'</span></div></div><div class="invoice-widget"><div class="pat-info-left"><div class="patient-img"><a href="'+l+'"><img src="'+r.foto_cliente+'" class="img-fluid" alt="User Image"></a></div><div class="pat-info-cont"><h4 class="pat-name"><a href="'+l+'">'+d+'</a></h4><div class="patient-details-col"><span class="">#'+r.id_group+'</span></div><div class="hour-col"><div><span class="hours">'+r.nome_cliente+"</span></div></div></div></div></div></div>"),"Pendente"!=o&&"Em Andamento"!=o&&"Finalizado"!=o||(i+='<div class="patient-widget"><div class="patient-top-details"><div><span class="invoice-id"><strong>'+r.br_start+'</strong></span></div><div><span class="date-col '+n+'">'+o+'</span></div></div><div class="invoice-widget"><div class="pat-info-left"><div class="patient-img"><a href="'+l+'"><img src="'+r.foto_cliente+'" class="img-fluid" alt="User Image"></a></div><div class="pat-info-cont"><h4 class="pat-name"><a href="'+l+'">'+d+'</a></h4><div class="patient-details-col"><span class="">#'+r.id_group+'</span></div><div class="hour-col"><div><span class="hours">'+r.nome_cliente+"</span></div></div></div></div></div></div>"),$$("#open_list_approve").append(s),$$("#open_list_pending").append(i),a.continue()}e.close()}},500)}}function call_open_events_groups_off(e){let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});var a=t.id;t.type;null!=a&&"null"!=a||app.views.main.router.navigate({name:"sign-in"});var s,i=window.indexedDB.open("AnyInspect_dnata",3);i.onsuccess=function(t){s=i.result,setTimeout(function(){$$("#open_list_grupo").html("");s.transaction("tb_events_group").objectStore("tb_events_group").openCursor().onsuccess=function(t){var a=t.target.result,s="",i="",n="",o="",l="",c="";if(a)if(a.value.id_group==e){var r=(s=a.value).endereco_cliente,d=s.cidade_cliente,u=s.cep_cliente,p=s.num_cliente,v=s.bairro_cliente;s.phone_cliente;""!=r&&(r=r),""!=d&&(d=" , "+d),""!=p&&(p=" , "+p),""!=u&&(u=" , "+u),""!=v&&(v=" , "+v);var _=r+v+p+d+u;if("Pendente"==(i=s.status_)&&(c="list_status_pendente"),"Em Andamento"==i&&(i="Em Andamento",c="list_status_andamento","read"),"Cancelado"==i&&(i="Cancelado",c="list_status_cancelado","read"),"Deletado"==i&&(i="Deletado",c="list_status_deletado"),"Concluído"==i&&(i="Concluído",c="list_status_concluido","read"),"Finalizado"==i&&(c="list_status_finalizado","read"),s.total_groups,$$("#foto_empresa_gru").html('<img style="border-radius:5px!important;min-width:60px;width:60px;" src="'+s.foto_cliente+'" alt="">'),$$("#nome_empresa_gru").html("<strong>"+s.nome_cliente+"</strong>"),$$("#end_empresa_gru").html('<div><i style="color:#9c9c9c;" class="fa fa-map-marker"></i> <small>'+_+"</small></div>"),$$("#phone_cliente_gru").html('<i style="color:#9c9c9c;" class="fa fa-phone"></i> <small>'+s.phone_cliente+"</small>"),s.desc_service.length>35)var f=s.desc_service.substring(0,34)+"...";else f=s.desc_service;l+='<div class="patient-widget"><a href="'+(n="/atividade/"+s.id)+'"><div class="patient-top-details"><div><span class="invoice-id"><strong>'+s.qrcode+'</strong></span></div><div><span class="date-col '+c+'">'+i+'</span></div></div><div class="invoice-widgets"><div class="pat-info-lefts"><div class="pat-info-conts"><h4 class="pat-name"><a href="'+n+'"> <strong>'+s.ativo+'</strong></a></h4><div class="patient-details-col"><span class="">#'+s.id+" "+f+'</span></div><div class="hour-col"><div><h5 class="hours">'+s.br_start+"</h5></div></div></div></div></div></a></div>",o='<h6 class="mt-4">0% Completo</h6><div class="progress mb-3"><div class="progress-bar bg-primary" style="width:0%; height:6px;" role="progressbar"><span class="sr-only">0% Completo</span></div></div>',$$("#open_list_grupo").append(l),$$("#percent_act").html(o),a.continue()}else a.continue();$("#search_events_all").keyup(function(){var e=this,t=$("#open_list_grupo > div"),a=t.filter(function(t,a){var s=$(a).text().toUpperCase(),i=e.value.toUpperCase();return~s.indexOf(i)});t.hide(),a.show()})}},500)}}function get_info_gerais_off(e){$$("#boxcanvas_cli").width();let t=Utils.userData();if(null===t||"null"===t)return app.views.main.router.navigate({name:"sign-in"}),app.views.main.router.navigate("/sign-in/"),void app.views.main.router.navigate("/sign-in/",{clearPreviousHistory:!0});t.id;let a=t.type;var s,i=window.indexedDB.open("AnyInspect_dnata",3);i.onsuccess=function(t){s=i.result,setTimeout(function(){s.transaction("tb_single").objectStore("tb_single").openCursor().onsuccess=function(t){var s=t.target.result;if(s.value.id==e){var i,n,o=s.value,l=(n=o).endereco,c=n.empresa_cliente,r=n.lat_ativo,d=n.lon_ativo,u=n.id_group,p=o.cidade,v=(p=o.endereco_cliente,o.cidade_cliente),_=o.cep_cliente,f=o.num_cliente,m=o.phone_cliente;""!=p&&(p=p),""!=v&&(v=" , "+v),""!=f&&(f=" , "+f),""!=_&&(_=" , "+_),i=p+f+v+_;var b={flow_approve:o.flow_approve,geo_location:o.geo_location,image_require:o.image_require,image_single:o.image_single,qr_check_in:o.qr_check_in,signature:o.signature,signature_exec:o.signature_exec};$$("#nome_empresa_at").html("<strong>"+c+"</strong>"),$$("#end_empresa_at").html('<i style="color:#9c9c9c;" class="fa fa-map-marker"></i> '+i),$$("#phone_cliente").html(m),l=""!=l?""!=(l=l)?'<a class="open_map" style="color:#000;"> <i style="font-size:14px;margin-right: 5px;" class="ion-ios-pin" ></i>'+l+"</a>":l:"N/A";var g=n.status_,h=n.id,x=n.id_funcionario,y=n.id_form,k=n.qrcode,w=n.priority,C=n.info_extra,A="";generateFormOff(y,g,e,b,u),$("#titulo_atividade").html("<strong>"+n.desc_service+"</strong>"),$("#ativo_equipamento").html("<strong>"+k+" - "+n.descricao+"</strong>"),$("#local_ativo").html('<strong class="open_map_ativo">'+n.local_ativo+"</strong>"),$("#data_atividade").html("<strong>"+n.br_start+"</strong>"),$("#tempo_estimado").html("<strong>"+n.est_time+"</strong>"),$("#prioridade_").html("<strong>"+w+"</strong>"),$("#info_extra").html("<strong>"+C+"</strong>"),"Pendente"==g&&($$(".status_activity").html('<div class="content status_pendente"><span class="">'+g+"</span></div>"),$$(".right_tab_act").html(""),$$("#btn_action_service").html('<button id="comecar" class="button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>')),"Em Andamento"==g&&($$(".status_activity").html('<div class="content status_andamento"><span class="">'+g+"</span></div>"),$$("#btn_action_service").html(""),setTimeout(function(){window.animatelo.bounceIn(".right_tab_act")},300),A='<div class="col-100"><button id="finalizar" class="button btn_status_finalizado change_status_service scaleffect no-active-state">Finalizar Atividade</button></div>',$$("#box_finish_action").html(A),window.animatelo.bounceIn("#box_finish_action")),"Finalizado"==g&&($$(".status_activity").html('<div class="content status_finalizado"><span class="">'+g+"</span></div>"),"a"==a||"g"==a||"r"==a?1==b.flow_approve&&($$("#box_finish_action").show(),$$("#box_finish_action").html('<button style="float: left;width: 48%;margin-right: 5px;font-size: 16px;line-height: inherit;" id="concluido" class="btn status_approve  button btn_approve change_status_approve scaleffect">Aprovar</button><button id="reprovado" style="float: left;width: 48%;margin-right: 5px;font-size: 16px;line-height: inherit;" class="btn btn_repprove status_repprove button  change_status_approve scaleffect">Reprovar</button>'),$$("#box_finish_action").show()):($$("#box_save_checklist").hide(),$$("#box_finish_action").hide(),$$("#box_action_sigcli").hide())),"Concluído"==g&&($$(".status_activity").html('<div class="content status_concluido"><span class="">'+g+"</span></div>"),$$("#box_save_checklist").html(""),$$("#box_save_checklist").hide(),$$("#box_finish_action").hide(),$$("#box_save_checklist").hide()),setTimeout(function(){$$(".scaleffect").on("touchstart",function(){$$(this).addClass("box-scale")}),$$(".scaleffect").on("touchend",function(){$$(this).removeClass("box-scale")}),$$(".open_map_ativo").on("click",function(e){e.preventDefault(),-1!=navigator.platform.indexOf("iPhone")||-1!=navigator.platform.indexOf("iPad")||-1!=navigator.platform.indexOf("iPod")?window.open("maps://maps.google.com/maps?daddr="+r+","+d+"&amp;ll="):window.open("https://maps.google.com/maps?daddr="+r+","+d+"&amp;ll=")}),$$(".change_status_service").on("click",function(e){e.preventDefault();let t=this.id;Utils.userData();altera_status_off(h,t,x,y,b,u,n)}),$$(".change_status_approve").on("click",function(t){t.preventDefault();let a=this.id;var s;if("concluido"==a&&(s="Aprovar a Atividade",1==b.flow_approve)){var i=$$(".has_sign_tec").attr("src");if(null==i||"undefined"==i)return void app.toast.create({text:"Obrigatório Assinatura Responsável Técnico!",closeTimeout:2e3,cssClass:"error_toast"}).open()}if("reprovado"==a){s="Reprovar a Atividade";var n=app.sheet.create({el:".open_modal_approve",swipeToClose:!1,swipeToStep:!1,backdrop:!0,closeByBackdropClick:!1,closeByOutsideClick:!1});n.open();'<li class="item-content item-input"><div class="item-inner"><div class="item-input-wrap"><br><textarea id="reprove_message_" cols="30" rows="10" placeholder="Digite sua Justificativa"></textarea><br><button class="btn scaleffect no-active-state button btn_confirma_reprove">Confirmar</button><br><br><button style="background:#F44336" class="btn button scaleffect no-active-state close_manual" id="close_manual" >Cancelar</button></div></div></li>',$$("#box_noapprove").html('<li class="item-content item-input"><div class="item-inner"><div class="item-input-wrap"><br><textarea id="reprove_message_" cols="30" rows="10" placeholder="Digite sua Justificativa"></textarea><br><button class="btn scaleffect no-active-state button btn_confirma_reprove">Confirmar</button><br><br><button style="background:#F44336" class="btn button scaleffect no-active-state close_manual" id="close_manual" >Cancelar</button></div></div></li>'),$$(".close_manual").on("click",function(e){e.preventDefault(),n.close()}),$$(".btn_confirma_reprove").on("click",function(e){e.preventDefault();var t=$$("#reprove_message_").val();fetch(current_path+"/view/repprove_event",{method:"POST",headers:new Headers,body:JSON.stringify({repprove_message:t,eventID:h,acao:a,id_funcionario:x})}).then(e=>e.json()).then(e=>{if("SUCCESS"==e.status){"reprovado"==a?($$("#btn_action_service").html('<button id="comecar" class="btn button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '),$$("#box_finish_action").html("")):$$("#box_finish_action").html(""),n.close();let e=Utils.userData();e.id,e.type;$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>')}}).catch(e=>console.log(e))})}else app.dialog.confirm("Você tem certeza que deseja "+s+" ?","Confirmação ",function(){fetch(current_path+"/view/alteraStatus",{method:"POST",headers:new Headers,body:JSON.stringify({eventID:h,acao:a,id_funcionario:x,id_form:y})}).then(e=>e.json()).then(t=>{if("SUCCESS"==t.status){if("concluido"==a)$$("#btn_action_service").html(""),$$("#status_servico").html('<div class="content status_concluido"><span class="status_concluido ">Concluído</span></div>'),app.toast.create({text:"Salvo com Sucesso",closeTimeout:2e3,cssClass:"success_toast"}).open(),$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>');"reprovar"==a&&($$("#btn_action_service").html('<button id="comecar" class="button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '),$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'));let t=Utils.userData();t.id,t.type;$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),call_open_events_off(),get_info_gerais_off(e),call_open_events_groups_off(u)}}).catch(e=>console.log(e))})})},500)}else s.continue()}},500)}}function qr_info(){let e=Utils.userData();null!=e&&"null"!=e||app.views.main.router.navigate({name:"sign-in"});var t=e.id,a=e.type;null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});const s=new Html5Qrcode("qr-reader",!0);open_camera_qr_info(s),$$(".stopscanerios").click(function(){s.stop().then(e=>{s.clear()}).catch(e=>{})}),$$(".startcam").click(function(){open_camera_qr_info(s)}),$$(".back-qr").on("click",function(e){e.preventDefault(),s.stop().then(e=>{s.clear()}).catch(e=>{}),app.views.current.router.back()}),$$(".search_tag").on("click",function(e){e.preventDefault();var i=$$("#qr_tag_input").val();null!=i&&"null"!=i&&""!=i?fetch(current_path+"/view/get_qr_info",{method:"POST",headers:new Headers,body:JSON.stringify({IdUser:t,type:a,qrCodeMessage:i})}).then(e=>e.json()).then(e=>{"SUCCESS"==e.status?(app.preloader.hide(),s.stop().then(e=>{s.clear()}).catch(e=>{}),app.toast.create({text:"Encontrado com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),setTimeout(function(){app.views.main.router.navigate("/info_ativo/"+i)},100)):app.toast.create({text:"Ativo não encontrado!",closeTimeout:2e3,cssClass:"error_toast"}).open()}).catch(e=>console.log(e)):app.toast.create({text:"Digite a identificação!",closeTimeout:2e3,cssClass:"error_toast"}).open()})}function altera_status(e,t,a,s,i,n,o){let l=Utils.userData();null!=l&&"null"!=l||app.views.main.router.navigate({name:"sign-in"});let c=l.id,r=l.id,d=l.type;var u="",p="",v="",_=i,f=n,m=o.start_lat,b=o.id,g=o.qrcode;o.qr_checkin;if("comecar"==t)if("Iniciar Atividade",1==_.geo_location){if(""==m)return 0==_.qr_check_in?void app.views.main.router.navigate("/gps-signin/0/"+b+"/"+t+"/"+r+"/"+g+"/"+s+"/"+i+"/"+n+"/"+o):void app.views.main.router.navigate("/gps-signin/1/"+b+"/"+t+"/"+r+"/"+g+"/"+s+"/"+i+"/"+n+"/"+o);if(1==_.qr_check_in)return void app.views.main.router.navigate("/qr-signin/"+b+"/"+t+"/"+r+"/"+g+"/"+s+"/"+i+"/"+n+"/"+o)}else if(1==_.qr_check_in)return void app.views.main.router.navigate("/qr-signin/"+b+"/"+t+"/"+r+"/"+g+"/"+s);if("finalizar"==t&&"Enviar Aprovação","cancelar"==t&&"Cancelar Atividade","comecar"!=t&&1==_.signature_exec){if(null==(p=$$(".has_sign_rest_exec").attr("src"))||"undefined"==p)return void app.toast.create({text:"Obrigatório Assinatura Responsável Execução!",closeTimeout:2e3,cssClass:"error_toast"}).open();if(1==_.signature&&(null==(u=$$(".has_sign_client").attr("src"))||"undefined"==u))return void app.toast.create({text:"Obrigatório Assinatura Cliente",closeTimeout:2e3,cssClass:"error_toast"}).open()}if("concluido"==t)if(1==_.flow_approve){if(null==(v=$$(".has_sign_tec").attr("src"))||"undefined"==v)return void app.toast.create({text:"Obrigatório Assinatura Responsável Técnico!",closeTimeout:2e3,cssClass:"error_toast"}).open()}else $$("#box_finish_action").html("");if("finalizar"==t)if(1==_.flow_approve){if(!("a"!=d&&"r"!=d&&"g"!=d||null!=(v=$$(".has_sign_tec").attr("src"))&&"undefined"!=v))return void app.toast.create({text:"Obrigatório Assinatura Responsável Técnico!",closeTimeout:2e3,cssClass:"error_toast"}).open()}else t="concluido";fetch(current_path+"/view/alteraStatus",{method:"POST",headers:new Headers,body:JSON.stringify({eventID:e,acao:t,id_funcionario:c,id_form:s})}).then(e=>e.json()).then(i=>{status=i.status;var n="";if("comecar"==t)$$("#btn_action_service").html(""),$$("#status_servico").html('<div class="content status_andamento"><span class="">Em Andamento</span></div>'),$$(".status_activity").html('<div class="content status_andamento"><span class="">Em Andamento</span></div>'),$$(".right_tab_act").html('<a href="#tab-2" class="submit-btn tab-link"><img src="assets/img/icons/arrow.png" alt=""></a>'),setTimeout(function(){$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),call_open_events(),call_open_events_groups(f),get_info_gerais(e)},200),n='<div class="col-100"><button id="finalizar" class="button btn_status_finalizado change_status_service scaleffect no-active-state">Finalizar Atividade</button></div>',$$("#box_finish_action").html(n),app.toast.create({text:"Salvo com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),setTimeout(function(){$$(".change_status_approve").on("click",function(t){t.preventDefault();let i=this.id;var n;if("concluido"==i)if(n="Aprovar a Atividade",1==_.flow_approve){var o=$$(".has_sign_tec").attr("src");if(null==o||"undefined"==o)return void app.toast.create({text:"Obrigatório Assinatura Responsável Técnico!",closeTimeout:2e3,cssClass:"error_toast"}).open()}else $$("#box_finish_action").html("");if("reprovado"==i){n="Reprovar a Atividade";var l=app.sheet.create({el:".open_modal_approve",swipeToClose:!1,swipeToStep:!1,backdrop:!0,closeByBackdropClick:!1,closeByOutsideClick:!1});l.open();var c="";c='<div class="item-inner"><div class="item-input-wrap"><br><textarea id="reprove_message_" cols="30" rows="10" placeholder="Digite sua Justificativa"></textarea><br><button class="btn scaleffect no-active-state button btn_confirma_reprove">Confirmar</button><br><br><button style="background:#F44336" class="btn button scaleffect no-active-state close_manual" id="close_manual" >Cancelar</button></div></div>'+$$("#box_noapprove").html(c),$$(".close_manual").on("click",function(e){e.preventDefault(),l.close()}),$$(".btn_confirma_reprove").on("click",function(t){t.preventDefault();var s=$$("#reprove_message_").val();fetch(current_path+"/view/repprove_event",{method:"POST",headers:new Headers,body:JSON.stringify({repprove_message:s,eventID:e,acao:i,id_funcionario:a})}).then(e=>e.json()).then(t=>{if("SUCCESS"==t.status){console.log("the_status concluido - "+i),"reprovado"==i?($$("#btn_action_service").html('<button id="comecar" class="btn button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '),$$("#box_finish_action").html("")):$$("#box_finish_action").html(""),l.close();let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id,t.type;$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),get_info_gerais(e),call_open_events(),call_open_events_groups(f)}}).catch(e=>console.log(e))})}else app.dialog.confirm("Você tem certeza que deseja "+n+" ?","Confirmação ",function(){fetch(current_path+"/view/alteraStatus",{method:"POST",headers:new Headers,body:JSON.stringify({eventID:e,acao:i,id_funcionario:a,id_form:s})}).then(e=>e.json()).then(t=>{if("SUCCESS"==t.status){if("concluido"==i)$$("#btn_action_service").html(""),$$("#status_servico").html('<div class="content status_concluido"><span class="status_concluido ">Concluído</span></div>'),app.toast.create({text:"Salvo com Sucesso",closeTimeout:2e3,cssClass:"success_toast"}).open();"reprovar"==i&&($$("#btn_action_service").html('<button id="comecar" class="button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '));let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id,t.type;$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),$$("#box_finish_action").remove(),call_open_events(),get_info_gerais(e),call_open_events_groups(f)}}).catch(e=>console.log(e))})})},500);else if("Em Andamento"==t){$$("#status_servico").html('<div class="content status_andamento"><span class="">Em Andamento</span></div>'),$$(".status_activity").html('<div class="content status_andamento"><span class="">Em Andamento</span></div>'),$$(".right_tab_act").html('<a href="#tab-2" class="submit-btn tab-link"><img src="assets/img/icons/arrow.png" alt=""></a>'),n='<div class="col-100"><button id="finalizar" class="button btn_status_finalizado change_status_service scaleffect no-active-state">Finalizar Atividade</button></div>',$$("#box_finish_action").html(n),setTimeout(function(){$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),call_open_events(),call_open_events_groups(f),get_info_gerais(e)},200),app.toast.create({text:"Salvo com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open()}else if("cancelar"==t){$$("#btn_action_service").html('<button class="button btn_status_cancelado">Cancelado</button>'),$$("#status_servico").html('<div class="content status_cancelado"><span class="">Cancelado</span></div> '),$$(".status_activity").html('<div class="content status_cancelado"><span class="">Cancelado</span></div> '),open_manual_Tag.close();let e=Utils.userData();null!=e&&"null"!=e||app.views.main.router.navigate({name:"sign-in"});e.id,e.type;app.toast.create({text:"Salvo com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open()}else if("finalizar"==t){let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id;let i=t.type;var o="",l="";if(1==_.signature_exec){if(null==(l=$$(".has_sign_rest_exec").attr("src"))||"undefined"==l)return void app.toast.create({text:"Obrigatório Assinatura Responsável Execução!",closeTimeout:2e3,cssClass:"error_toast"}).open();if(1==_.signature){if(null==(o=$$(".has_sign_client").attr("src"))||"undefined"==o)return void app.toast.create({text:"Obrigatório Assinatura Cliente",closeTimeout:2e3,cssClass:"error_toast"}).open();"a"==i||"g"==i||"r"==i?$$("#box_finish_action").html('<button style="float:left;width:48%;margin-right:5px;font-size:16px;height:45px;" id="concluido" class="status_approve  button btn_approve change_status_approve scaleffect">Aprovar</button><button id="reprovado"  style="float:left;width:48%;font-size:16px;height:45px;" class="btn_repprove status_repprove button btn_status_reprovar change_status_approve scaleffect">Reprovar</button>'):$$("#box_finish_action").html(""),$$("#status_servico").html('<div class="content status_finalizado"><span class="">Finalizado</span></div>'),$$(".status_activity").html('<div class="content status_finalizado"><span class="">Finalizado</span></div>')}else"a"==i||"g"==i||"r"==i?$$("#box_finish_action").html('<button style="float: left;width:48%;margin-right:5px;font-size:16px;height:45px;" id="concluido" class="status_approve  button btn_approve change_status_approve scaleffect">Aprovar</button><button id="reprovado"  style="float:left;width:48%;font-size:16px;height:45px;" class="btn_repprove status_repprove button btn_status_reprovar change_status_approve scaleffect">Reprovar</button>'):$$("#box_finish_action").html(""),$$("#status_servico").html('<div class="content status_finalizado"><span class="">Finalizado</span></div>'),$$(".status_activity").html('<div class="content status_finalizado"><span class="">Finalizado</span></div>')}app.toast.create({text:"Salvo com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),$$("input,textarea,select").prop("disabled",!0),$$("#box_save_checklist").hide(),$$("#box_images_up").hide(),$$("#phone_cliente").prop("disabled",!1),$$("#zap_message").prop("disabled",!1),$$(".change_status_approve").on("click",function(t){t.preventDefault();let i=this.id;var n;if("concluido"==i&&(n="Aprovar a Atividade",1==_.flow_approve)){var o=$$(".has_sign_tec").attr("src");if(null==o||"undefined"==o)return void app.toast.create({text:"Obrigatório Assinatura Responsável Técnico!",closeTimeout:2e3,cssClass:"error_toast"}).open()}if("reprovado"==i){n="Reprovar a Atividade";var l=app.sheet.create({el:".open_modal_approve",swipeToClose:!1,swipeToStep:!1,backdrop:!0,closeByBackdropClick:!1,closeByOutsideClick:!1});l.open();'<li class="item-content item-input"><div class="item-inner"><div class="item-input-wrap"><br><textarea id="reprove_message_" cols="30" rows="10" placeholder="Digite sua Justificativa"></textarea><br><button class="btn scaleffect no-active-state button btn_confirma_reprove">Confirmar</button><br><br><button style="background:#F44336" class="btn button scaleffect no-active-state close_manual" id="close_manual" >Cancelar</button></div></div></li>',$$("#box_noapprove").html('<li class="item-content item-input"><div class="item-inner"><div class="item-input-wrap"><br><textarea id="reprove_message_" cols="30" rows="10" placeholder="Digite sua Justificativa"></textarea><br><button class="btn scaleffect no-active-state button btn_confirma_reprove">Confirmar</button><br><br><button style="background:#F44336" class="btn button scaleffect no-active-state close_manual" id="close_manual" >Cancelar</button></div></div></li>'),$$(".close_manual").on("click",function(e){e.preventDefault(),l.close()}),$$(".btn_confirma_reprove").on("click",function(t){t.preventDefault();var s=$$("#reprove_message_").val();fetch(current_path+"/view/repprove_event",{method:"POST",headers:new Headers,body:JSON.stringify({repprove_message:s,eventID:e,acao:i,id_funcionario:a})}).then(e=>e.json()).then(t=>{if("SUCCESS"==t.status){"reprovado"==i?($$("#btn_action_service").html('<button id="comecar" class="btn button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '),$$("#box_finish_action").html("")):$$("#box_finish_action").html(""),l.close();let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id,t.type;$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),get_info_gerais(e),call_open_events(),call_open_events_groups(f)}}).catch(e=>console.log(e))})}else app.dialog.confirm("Você tem certeza que deseja "+n+" ?","Confirmação ",function(){fetch(current_path+"/view/alteraStatus",{method:"POST",headers:new Headers,body:JSON.stringify({eventID:e,acao:i,id_funcionario:a,id_form:s})}).then(e=>e.json()).then(t=>{if("SUCCESS"==t.status){if("concluido"==i)$$("#btn_action_service").html(""),$$("#status_servico").html('<div class="content status_concluido"><span class="status_concluido ">Concluído</span></div>'),app.toast.create({text:"Salvo com Sucesso",closeTimeout:2e3,cssClass:"success_toast"}).open();"reprovar"==i&&($$("#btn_action_service").html('<button id="comecar" class="button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '));let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id,t.type;$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),get_info_gerais(e),call_open_events(),call_open_events_groups(f)}}).catch(e=>console.log(e))})}),$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),get_info_gerais(e),call_open_events(),call_open_events_groups(f)}else if("concluido"==t){$$("#btn_action_service").html(""),$$("#box_save_checklist").html(""),$$("#status_servico").html('<div class="content status_concluido "><span class="">Concluído</span></div> '),$$(".status_activity").html('<div class="content status_concluido "><span class="">Concluído</span></div> ');let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id,t.type;app.toast.create({text:"Salvo com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),0==_.flow_approve&&$("#box_finish_action").html(""),$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),get_info_gerais(e),call_open_events(),call_open_events_groups(f)}else"reprovar"==t&&($$("#btn_action_service").html('<button id="comecar" class="button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '),$$(".status_activity").html('<div class="content status_pendente"><span class="">Pendente</span></div> '),$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),get_info_gerais(e),call_open_events(),call_open_events_groups(f))}).catch(e=>console.log(e))}function generateFormOff(e,t,a,s,i){a=a,e=e;var n=Utils.userData();null!=n&&"null"!=n||app.views.main.router.navigate({name:"sign-in"});n.id;var o=n.type;$("#sjfb-fields").empty();var l,c=window.indexedDB.open("AnyInspect_dnata",3);c.onsuccess=function(i){l=c.result,setTimeout(function(){l.transaction("tb_form").objectStore("tb_form").openCursor().onsuccess=function(i){var n=i.target.result;if(n.value.id==e){var c=n.value.conteudo_formulario;if(c){var r=JSON.parse(c),u="",p=0,v=1,_="",f="",m="";if(null==r||"null"==r);else{$("#box_sig_cli").append('<div class="text-center" ><h3 style="margin-bottom: 30px;">Assinaturas</h3></div>'),$.each(r,function(i,n){var o=n.type,l=n.label;_=o,f=l;var c=n.label.split("@");if(m=c[0],c[1],"signature_box"==_){let s=Utils.userData();null!=s&&"null"!=s||app.views.main.router.navigate({name:"sign-in"});s.id;let i=s.type;if("Concluído"==t)var r='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" class="box row js-signature-'+e+"-"+v+' " ><div class="col-100 text-center"></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+f+"</div>";else if("Finalizado"==t)if("Responsável Técnico"==m)if("a"==i||"g"==i||"r"==i)r='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" class="box row js-signature-'+e+"-"+v+' " ><div class="col-100 text-center"><a href="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" style="padding:5px;" class="item-link item-content link edit_tecnico" ><i class="fa fa-pencil-square-o" style="font-size: 16px;"></i>Assinar</a></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+f+"</div>";else r='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" class="box row js-signature-'+e+"-"+v+' " ><div class="col-100 text-center"></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+f+"</div>";else r='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" class="box row js-signature-'+e+"-"+v+' " ><div class="col-100 text-center"></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+f+"</div>";else if("Em Andamento"==t)if("Responsável Execução"==m)r='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" class="box row js-signature-'+e+"-"+v+' " ><div class="col-100 text-center"><a href="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" style="padding:5px;" class="item-link item-content link edit_resp_exec_sign" ><i class="fa fa-pencil-square-o" style="font-size: 16px;"></i>Assinar</a></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+f+"</div>";else if("Cliente"==m)r='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" class="box row js-signature-'+e+"-"+v+' " ><div class="col-100 text-center"><a href="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" style="padding:5px;" class="item-link item-content link edit_client_sign" ><i class="fa fa-pencil-square-o" style="font-size: 16px;"></i>Assinar</a></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+f+"</div>";else if("Responsável Técnico"==m)if("a"==i||"g"==i||"r"==i)r='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" class="box row js-signature-'+e+"-"+v+' " ><div class="col-100 text-center"><a href="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" style="padding:5px;" class="item-link item-content link " ><i class="fa fa-pencil-square-o" style="font-size: 16px;"></i>Assinar</a></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+f+"</div><br>";else r='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" class="box row js-signature-'+e+"-"+v+' " ><div class="col-100 text-center"></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+f+"</div>";else r='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" class="box row js-signature-'+e+"-"+v+' " ><div class="col-100 text-center"></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+f+"</div>";else if("Responsável Técnico"==m)if("a"==i||"g"==i||"r"==i)r='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" class="box row js-signature-'+e+"-"+v+' " ><div class="col-100 text-center"><a href="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" style="padding:5px;" class="item-link item-content link " ><i class="fa fa-pencil-square-o" style="font-size: 16px;"></i>Assinar</a></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+f+"</div>";else r='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" class="box row js-signature-'+e+"-"+v+' " ><div class="col-100 text-center"></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+f+"</div>";else r='<div id="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" class="box row js-signature-'+e+"-"+v+' " ><div class="col-100 text-center"><a href="/signature-page/'+e+"/"+a+"/js-signature-"+e+"-"+v+"/"+m+'" style="padding:5px;" class="item-link item-content link " ><i class="fa fa-pencil-square-o" style="font-size: 16px;"></i>Assinar</a></div></div><div style="border-top: 1px solid gray;margin-bottom: 30px;margin-top: 5px;" class="col-100 text-center">Assinatura '+f+"</div>";$("#box_sig_cli").append(r)}$("#sjfb-fields").append(d(o,a,l,s,e));var b=$("#sjfb-fields .sjfb-field").last();if(b.find("label").text(n.label),n.choices){var g=b.find("label").text(m).prevObject[0].id,h=b.find("label").text(m).prevObject[0].id,x="",y="";$.each(n.choices,function(e,t){if("select"==o){var a="<option"+(s=t.sel?" selected":"")+">"+t.label+"</option>";b.find(".choices").append(a)}else if("radio"==o){var s=t.sel?" checked":"";"Sim"==t.label&&(x="fa fa-thumbs-up",y="yes_option"),"Não"==t.label&&(x="fa fa-thumbs-down",y="no_option"),"N/A"==t.label&&(x="fa fa-ban",y="na_option");a='<label for="radio-'+p+'" class="col-33"><input class="'+u+'" id="radio-'+p+'" type="radio" name="radio-'+g+'" '+s+' value="'+t.label+'" ><div class="front-end box '+y+' "><i class="'+x+'"></i></div></label>';b.find(".choices").append(a)}else if("checkbox"==o){s=t.sel?" checked":"",a='<label class="col-12 item-content"><div class="form-check mb-5 mr-5"><input class="form-check-input styled-checkbox '+u+' " id="ch_'+p+'" type="checkbox" name="checkbox-'+h+'[]"'+s+' value="'+t.label+'" ><label for="ch_'+p+'" class="form-check-label check-green ">'+t.label+"</label></div></label>";b.find(".choices").append(a)}p++,$(".img_file").removeAttr("required"),$(".img_file").removeAttr("required-choice")})}n.req&&("file"==o?b.find("input").prop("required",!1).removeClass("required-choice"):"text"==o?b.find("input").prop("required",!0).addClass("required-choice"):"textarea"==o?b.find("textarea").prop("required",!0).addClass("required-choice"):"select"==o?b.find("select").prop("required",!0).addClass("required-choice"):"radio"==o?b.find("input").prop("required",!0).addClass("required-choice"):"number"==o?b.find("input").prop("required",!0).addClass("required-choice"):"date"==o?b.find("input").prop("required",!0).addClass("required-choice"):"time"==o&&b.find("input").prop("required",!0).addClass("required-choice"),b.addClass("required-field")),v++}),setTimeout(function(){$(".calendar_date_time_check").click(function(e){e.preventDefault();var t=$(this).attr("id"),a=app.calendar.create({inputEl:t,timePicker:!1,dateFormat:"dd/mm/yyyy",on:{change:function(e,t,a,s,i){},dayClick:function(e,s,i,n,o){n<10&&(n="0"+n);var l=o+"/"+n+"/"+i;$$("#"+t).val(l),a.close()}}});a.open()}),$(".calendar_time_check").click(function(e){e.preventDefault();var t=$(this).attr("id"),a=app.picker.create({inputEl:t,rotateEffect:!0,cols:[{textAlign:"left",values:"01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23".split(" ")},{values:":".split(" ")},{values:"00 05 10 15 20 25 30 35 40 45 50 55".split(" ")}],on:{closed:function(e,s,i,n,o){e.value[0],e.value[2];var l=e.value[0]+e.value[1]+e.value[2];$$("#"+t).val(l),a.close()}}});a.open()})},200),$("#sjfb-fields").append('<div id="box_save_checklist" style="padding:10px;"><button style="width:100%;" type="submitt" class="scaleffect btn btn-primary save_check_list button">Salvar Atividades</button></div>'),$$(".scaleffect").on("touchstart",function(){$$(this).addClass("box-scale")}),$$(".scaleffect").on("touchend",function(){$$(this).removeClass("box-scale")}),"Finalizado"!=t&&"Concluído"!=t||(u="disabled",$("input,textarea,select").prop("disabled",!0),$("#box_save_checklist").hide(),$("#phone_cliente").prop("disabled",!1),$("#zap_message").prop("disabled",!1)),setTimeout(function(){!function(a,s){l.transaction("tb_event_result").objectStore("tb_event_result").openCursor().onsuccess=function(t){var a=t.target.result;if(a)if(a.value.at==s&&a.value.formID==e){var i=a.value,n=JSON.parse(i.data);$.each(n,function(e,t){for(var a=t.name,s=t.value,i=document.getElementsByName(a),n=0;n<i.length;n++)s==i[n].value&&(a.indexOf("checkbox")>-1||$("input[name="+a+"]").val([s]));$$('input[name="'+a+'[]"]').each(function(){var e=s.split(",");for(n=0;n<e.length;n++)e[n]==$(this).attr("value")&&$(this).prop("checked",!0)}),a.indexOf("checkbox")>-1||(a.indexOf("select")>-1?$$("select[name="+a+"]").val([s[0]]):a.indexOf("textarea")>-1?$$("textarea[id="+a+"]").val([s[0]]):$$("input[id="+a+"]").val([s[0]]))})}else 0,a.continue()},l.transaction("tb_event_result").objectStore("tb_event_result").openCursor().onsuccess=function(a){var i=a.target.result,n="",l="",c="";if(i)if(i.value.IdEvento==s&&i.value.IdFormulario==e){n=i.value.campo,l=i.value.valor;for(var r=document.getElementsByName(n),d=0;d<r.length;d++)l==r[d].value&&(n.indexOf("checkbox")>-1||$("input[name="+n+"]").val([l]));if($$('input[name="'+n+'[]"]').each(function(){var e=l.split(",");for(d=0;d<e.length;d++)e[d]==$(this).attr("value")&&$(this).prop("checked",!0)}),n.indexOf("js-signature")>-1){if($("."+n)[0]){var u=$("."+n)[0].id;if(l=null==l||"null"==l?"":l,"Concluído"==t)c='<div class="title-col-100" style="padding:10px"><h6 style="width: 100%;"><img class="has_sign_tec" id="'+u+'" src="'+l+'" alt="Assinatura"></h6></div>';else if("Finalizado"==t){if(u){var p=u.split("/");p=p.slice(-1).pop();var v="",_="";if("Responsável Técnico"==p)if("a"==o||"g"==o||"r"==o){if(""==l)var v="";else v='<img class="has_sign_tec" id="'+u+'" src="'+l+'" alt="Assinatura">';c='<div class="title-col-100" style="padding:10px"><a href="'+u+'" class="box-shadow tem-link item-content link " style="background: #d0d0d0;border-radius: 50%;float: right;padding: 8px;position: absolute;right: 10px;margin-top:-25px;"><i class="fa fa-pencil-square-o" style="font-size: 16px;color: #4c4c4c;"></i></a><h6 style="width: 100%;">'+v+"</h6></div>"}else{if(""==l)var v="";else v='<img class="has_sign_tec" id="'+u+'" src="'+l+'" alt="Assinatura">';c='<div class="title-col-100" style="padding:10px"><h6 style="width: 100%;">'+v+"</h6></div>"}else if("Responsável Execução"==p)if("a"==o||"g"==o||"r"==o){if(""==l)var v="";else v='<img class="has_sign_resp_exec" id="'+u+'" src="'+l+'" alt="Assinatura">';c='<div class="title-col-100" style="padding:10px"><a href="'+u+'" class="box-shadow tem-link item-content link " style="background: #d0d0d0;border-radius: 50%;float: right;padding: 8px;position: absolute;right: 10px;margin-top:-25px;"><i class="fa fa-pencil-square-o" style="font-size: 16px;color: #4c4c4c;"></i></a><h6 style="width: 100%;">'+v+"</h6></div>"}else{if(""==l)var v="";else v='<img class="has_sign_resp_exec" id="'+u+'" src="'+l+'" alt="Assinatura">';c='<div class="title-col-100" style="padding:10px"><h6 style="width: 100%;">'+v+"</h6></div>"}else if("a"==o||"g"==o||"r"==o){if(""==l)var _="";else _='<img class="has_sign_resp_client" id="'+u+'" src="'+l+'" alt="Assinatura">';c='<div class="title-col-100" style="padding:10px"><a href="'+u+'" class="box-shadow tem-link item-content link " style="background: #d0d0d0;border-radius: 50%;float: right;padding: 8px;position: absolute;right: 10px;margin-top:-25px;"><i class="fa fa-pencil-square-o" style="font-size: 16px;color: #4c4c4c;"></i></a><h6 style="width: 100%;">'+_+"</h6></div>"}else{if(""==l)var _="";else _='<img class="has_sign_resp_client" id="'+u+'" src="'+l+'" alt="Assinatura">';c='<div class="title-col-100" style="padding:10px"><h6 style="width: 100%;">'+_+"</h6></div>"}}}else if(u){var p=u.split("/");p=p.slice(-1).pop();var f="";if("Responsável Execução"==p){if(""==l)var f="";else f='<img class="has_sign_rest_exec" id="'+u+'" src="'+l+'" alt="Assinatura">';c='<div class="title-col-100" style="padding:10px"><a href="'+u+'" class="box-shadow tem-link item-content link " style="background: #d0d0d0;border-radius: 50%;float: right;padding: 8px;position: absolute;right: 10px;margin-top:-25px;"><i class="fa fa-pencil-square-o" style="font-size: 16px;color: #4c4c4c;"></i></a><h6 style="width: 100%;">'+f+"</h6></div>"}else if("Cliente"==p){var _="";if(""==l)var _="";else _='<img class="has_sign_client" id="'+u+'" src="'+l+'" alt="Assinatura">';c='<div class="title-col-100" style="padding:10px"><a href="'+u+'" class="box-shadow tem-link item-content link " style="background: #d0d0d0;border-radius: 50%;float: right;padding: 8px;position: absolute;right: 10px;margin-top:-25px;"><i class="fa fa-pencil-square-o" style="font-size: 16px;color: #4c4c4c;"></i></a><h6 style="width: 100%;">'+_+"</h6></div>"}else{var _="";if(""==l)var _="";else _='<img class="has_sign_tec" id="'+u+'" src="'+l+'" alt="Assinatura">';c="a"==o||"g"==o||"r"==o?'<div class="title-col-100" style="padding:10px"><a href="'+u+'" class="box-shadow tem-link item-content link " style="background: #d0d0d0;border-radius: 50%;float: right;padding: 8px;position: absolute;right: 10px;margin-top:-25px;"><i class="fa fa-pencil-square-o" style="font-size: 16px;color: #4c4c4c;"></i></a><h6 style="width: 100%;">'+_+"</h6></div>":'<div class="title-col-100" style="padding:10px"><h6 style="width: 100%;">'+_+"</h6></div>"}}$("."+n).html(c)}}else n.indexOf("checkbox")>-1||(n.indexOf("select")>-1?(console.log(n),$("select[name="+n+"]").val([l])):$("input[name="+n+"]").val([l]));i.continue()}else 0,i.continue()}}(id_form,a)},150),$("input[type='text']").change(function(){this.value&&$(this).css("border","1px solid #dddfe1;")}),$(".save_check_list").on("click",function(t){t.preventDefault();for(var s=document.getElementById("sjfb-sample").querySelectorAll("[required]"),i=(document.getElementById("check"),document.getElementById("output"),0);i<s.length;i++){if(!((t=s[i]).value.length>0)){var n=$("#"+t.id).offset().top-$(window).scrollTop();return $(".page-content").animate({scrollTop:n+20},600),$("#"+t.id).focus(),$("#"+t.id).blur(),$("#"+t.id).css("border","1px solid #f44336"),toast_message=app.toast.create({text:"Campo obrigatório",closeTimeout:3e3,cssClass:"error_toast"}),toast_message.open(),!1}$("#"+t.id).css("border","1px solid #e6e6e6")}var o=$("#sjfb-sample").serializeArray(),l=[];o.forEach(function(e){var t=l.filter(function(t,a){return t.name==e.name});if(t.length){var a=l.indexOf(t[0]);l[a].value=l[a].value.concat(e.value)}else"string"==typeof e.value&&(e.value=[e.value]),l.push(e)});var c,r=JSON.stringify(l),d=JSON.stringify(l),u=window.indexedDB.open("AnyInspect_dnata",3);u.onsuccess=function(t){c=u.result,setTimeout(function(){c.transaction("tb_save_event").objectStore("tb_save_event").openCursor().onsuccess=function(t){var s,i=t.target.result;if(i)if(i.value.at==a&&i.value.formID==e){console.log("e igual o id e form"),r=i.value,1;var n,o=i.key,l=c.transaction(["tb_save_event"],"readwrite").objectStore("tb_save_event");(n=l.get(o)).onerror=function(e){},n.onsuccess=function(e){var t=n.result;t.data=d;var a=l.put(t);a.onerror=function(e){app.toast.create({text:"Erro ao salvar!",closeTimeout:2e3,cssClass:"error_toast"}).open()},a.onsuccess=function(e){app.toast.create({text:"Salvo com Sucesso",closeTimeout:2e3,cssClass:"success_toast"}).open()}}}else 0,i.continue();else(n=window.indexedDB.open("AnyInspect_dnata",3)).onsuccess=function(t){s=n.result,setTimeout(function(){var t=s.transaction(["tb_save_event"],"readwrite").objectStore("tb_save_event").add({formID:e,at:a,data:r});t.onsuccess=function(e){e.target.result,s.close(),app.toast.create({text:"Erro ao salvar!",closeTimeout:2e3,cssClass:"success_toast"}).open()},t.onerror=function(e){app.toast.create({text:"Erro ao salvar!",closeTimeout:2e3,cssClass:"error_toast"}).open()}},200)}}},500)}})}}}else n.continue()}},500)};var r=0;function d(e,t,a,s,i){r++;var n=i,o="";switch(o=1==s.image_single?'<div class="row block" style="text-align: center;margin-top: 10px;border-top: 1px solid #ececec;padding: 10px;"><div class="action_block col-33" ><a href="/comments-atividade/'+n+"-"+r+"/"+t+"/"+a+' " ><i class="fa fa-comment"></i>  </a></div><div class="action_block col-33"><a href="/imagem-atividade/'+n+"-"+r+"/"+t+"/"+a+' "><i class="fa fa-camera"></i> </a></div><div class="action_block col-33"><a href="/pa-atividade/'+n+"-"+r+"/"+t+"/"+a+' "><i class="fa fa-exclamation-triangle"></i> </a></div></div>':"Observações"==a?'<div class="row block" style="text-align: center;margin-top: 10px;border-top: 1px solid #ececec;padding: 10px;"><div class="action_block col-33" ><a href="/comments-atividade/'+n+"-"+r+"/"+t+"/"+a+' " ><i class="fa fa-comment"></i>  </a></div><div class="action_block col-33"><a href="/imagem-atividade/'+n+"-"+r+"/"+t+"/"+a+' "><i class="fa fa-camera"></i> </a></div><div class="action_block col-33"><a href="/pa-atividade/'+n+"-"+r+"/"+t+"/"+a+' "><i class="fa fa-exclamation-triangle"></i> </a></div></div>':'<div style="margin-top:20px;"></div>',e){case"text":return'<div id="sjfb-'+n+'" class="sjfb-field sjfb-text field_elements "><div class="block" ><label for="text-'+n+'" class="block-title" ></label></div><input name="text-'+n+"-"+r+'" class="form-control" type="text" id="text-'+n+"-"+r+'">'+o+"</div>";case"number":return'<div id="sjfb-'+n+'" class="sjfb-field sjfb-number field_elements "><div class="block" ><label for="number-'+n+'" class="block-title" ></label></div><input name="number-'+n+"-"+r+'" class="form-control" type="number" id="number-'+n+"-"+r+'">'+o+"</div>";case"date":return'<div id="sjfb-'+n+'" class="sjfb-field sjfb-date field_elements "><div class="block" ><label for="date-'+n+'" class="block-title" ></label></div><input name="date-'+n+"-"+r+'" class="form-control calendar_date_time_check" type="text" id="date-'+n+"-"+r+'">'+o+"</div>";case"time":return'<div id="sjfb-'+n+'" class="sjfb-field sjfb-time field_elements "><div class="block" ><label for="time-'+n+'" class="block-title" ></label></div><input name="time-'+n+"-"+r+'" class="form-control calendar_time_check" type="text" id="time-'+n+"-"+r+'">'+o+"</div>";case"textarea":return'<div id="sjfb-'+n+'" class="sjfb-field sjfb-textarea field_elements"><div class="block" ><label for="textarea-'+n+'" class="block-title"></label></div><textarea class="form-control form-control-lg" name="textarea-'+n+"-"+r+'"  id="textarea-'+n+"-"+r+'"></textarea>'+o+"</div>";case"select":return'<div id="sjfb-'+n+'" class="sjfb-field sjfb-select field_elements"><div class="block" ><label for="select-'+n+'" class="block-title"></label></div><select name="select-'+n+"-"+r+'" id="select-'+n+"-"+r+'" class="form-control choices choices-select"></select>'+o+"</div>";case"radio":return'<div id="sjfb-'+n+"-"+r+'" class="list sjfb-field sjfb-radio field_elements"><div class="block" ><label class="block-title"></label></div><li class="row choices choices-radio"></li>'+o+"</div>";case"checkbox":return'<div id="sjfb-'+n+"-"+r+'" class="list sjfb-field sjfb-checkbox field_elements"><div class="block" ><label class="block-title"></label></div><li class="choices choices-checkbox"></li>'+o+"</div>";case"section":return"Assinaturas"==a?'<div id="sjfb-section-'+n+'" class="sjfb-field sjfb-section required-field" style="background: #ffffff;color: #fff;margin-bottom: 0px;padding: 0;border-bottom: 0px;"><label class="block-title" style="color:#fff;"></label></div>':'<div id="sjfb-section-'+n+'" class="sjfb-field sjfb-section required-field" style="background:#d0d0d0;color:#333;margin-bottom: 0px;padding: 5px;border-bottom: 0px;"><label class="block-title" style="padding: 5px;"></label></div>';case"agree":return'<div id="sjfb-agree-'+n+'" class="sjfb-field sjfb-agree required-field"><input name="checkbox-'+n+"-"+r+'" type="checkbox" required><label class="block-title"></label></div>'}}}function save_comment_off(e,t){var a=$$("#new_comment_element").val(),s="";if(""!=a){var i,n=window.indexedDB.open("AnyInspect_dnata",3);n.onsuccess=function(o){i=n.result,setTimeout(function(){var n=i.transaction(["tb_save_event_comment"],"readwrite").objectStore("tb_save_event_comment").add({id_booking:t,id_element:e,comment:a});n.onsuccess=function(e){e.target.result,i.close(),s+='<section class="year"><section><ul><li>'+a+"<br><small>"+date_create+"</small></li></ul></section></section>",$$("#comment_list").append(s),app.toast.create({text:"Salco com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),$$("#new_comment_element").val("")},n.onerror=function(e){app.toast.create({text:"Erro ao salvar!",closeTimeout:2e3,cssClass:"error_toast"}).open()}},200)}}else toast_message=app.toast.create({text:"Digite algum comentário",closeTimeout:3e3,cssClass:"error_toast"}),toast_message.open()}function save_pa_off(e,t){var a=$$("#what_at").val(),s=$$("#why_at").val(),i=$$("#how_at").val(),n=$$("#resp_at").val(),o=$$("#where_at").val(),l=$$("#when_at").val(),c=$$("#cost_at").val();$.ajax({url:current_path+"/controller/update_pa",type:"POST",dataType:"JSON",data:{id_booking:t,id_element:e,what_at:a,why_at:s,how_at:i,resp_at:n,where_at:o,when_at:l,cost_at:c},success:function(e){status=e.status,"SUCCESS"==status?(toast_message=app.toast.create({text:"Salvo com Sucesso",closeTimeout:3e3,cssClass:"success_toast"}),toast_message.open()):(toast_message=app.toast.create({text:"Erro ao salvar",closeTimeout:3e3,cssClass:"error_toast"}),toast_message.open())}})}function save_event(e){var t,a=$("#Idtubulacao").val(),s=$("#Observacao").val(),i=$("#local").val(),n=Utils.userData().id,o=window.indexedDB.open("Braskem",1);o.onsuccess=function(l){t=o.result,setTimeout(function(){var o=t.transaction(["tb_tubulacao_local"],"readwrite").objectStore("tb_tubulacao_local").add({Idtubulacao:a,IdUsuario:n,Localizacao:i,DataRegistro:e,Observacao:s});o.onsuccess=function(e){e.target.result,t.close(),app.toast.create({text:"Registrado com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open()},o.onerror=function(e){app.toast.create({text:"Erro ao registrar localização!",closeTimeout:2e3,cssClass:"error_toast"}).open()}},200)}}function update_data(e,t,a){var s=db.transaction([e],"readwrite").objectStore(e),i=s.get(t);i.onerror=function(e){},i.onsuccess=function(e){var t=i.result;t.gps_lat=a.gps_lat,t.gps_lon=a.gps_lon;var n=s.put(t);n.onerror=function(e){},n.onsuccess=function(e){}}}function altera_status_off(e,t,a,s,i,n,o){let l=Utils.userData();null!=l&&"null"!=l||app.views.main.router.navigate({name:"sign-in"});l.id;let c=l.id,r=l.type;var d="",u="",p="",v=i,_=n,f=o.start_lat,m=o.id,b=o.qrcode;o.qr_checkin;if("comecar"==t)if("Iniciar Atividade",1==v.geo_location){if(""==f)return 0==v.qr_check_in?void app.views.main.router.navigate("/gps-signin/0/"+m+"/"+t+"/"+c+"/"+b+"/"+s+"/"+i+"/"+n+"/"+o):void app.views.main.router.navigate("/gps-signin/1/"+m+"/"+t+"/"+c+"/"+b+"/"+s+"/"+i+"/"+n+"/"+o);if(1==v.qr_check_in)return void app.views.main.router.navigate("/qr-signin/"+m+"/"+t+"/"+c+"/"+b+"/"+s+"/"+i+"/"+n+"/"+o)}else if(1==v.qr_check_in)return void app.views.main.router.navigate("/qr-signin/"+m+"/"+t+"/"+c+"/"+b+"/"+s);if("finalizar"==t&&"Enviar Aprovação","cancelar"==t&&"Cancelar Atividade","comecar"!=t&&1==v.signature_exec){if(null==(u=$$(".has_sign_rest_exec").attr("src"))||"undefined"==u)return void app.toast.create({text:"Obrigatório Assinatura Responsável Execução!",closeTimeout:2e3,cssClass:"error_toast"}).open();if(1==v.signature&&(null==(d=$$(".has_sign_client").attr("src"))||"undefined"==d))return void app.toast.create({text:"Obrigatório Assinatura Cliente",closeTimeout:2e3,cssClass:"error_toast"}).open()}if("concluido"==t)if(1==v.flow_approve){if(null==(p=$$(".has_sign_tec").attr("src"))||"undefined"==p)return void app.toast.create({text:"Obrigatório Assinatura Responsável Técnico!",closeTimeout:2e3,cssClass:"error_toast"}).open()}else $$("#box_finish_action").html("");if("finalizar"==t)if(1==v.flow_approve){if(!("a"!=r&&"r"!=r&&"g"!=r||null!=(p=$$(".has_sign_tec").attr("src"))&&"undefined"!=p))return void app.toast.create({text:"Obrigatório Assinatura Responsável Técnico!",closeTimeout:2e3,cssClass:"error_toast"}).open()}else t="concluido";var g=db.transaction(["tb_events_group"],"readwrite").objectStore("tb_events_group"),h=g.get(e);h.onerror=function(e){},h.onsuccess=function(e){var a,s=h.result;"comecar"==t?a="Em Andamento":"cancelar"==t?a="Cancelado":"reprovar"==t?a="Cancelado":"finalizar"==t?a="Finalizado":"concluido"==t&&(a="Concluído"),s.status_=a;var i=g.put(s);i.onerror=function(e){},i.onsuccess=function(e){}};var x=db.transaction(["tb_single"],"readwrite").objectStore("tb_single"),y=x.get(e);y.onerror=function(e){},y.onsuccess=function(i){var n,o=y.result;"comecar"==t?n="Em Andamento":"cancelar"==t?n="Cancelado":"reprovar"==t?n="Cancelado":"finalizar"==t?n="Finalizado":"concluido"==t&&(n="Concluído"),o.status_=n;var l=x.put(o);l.onerror=function(e){},l.onsuccess=function(i){status=o.status;var n="";if("comecar"==t)$$("#btn_action_service").html(""),$$("#status_servico").html('<div class="content status_andamento"><span class="">Em Andamento</span></div>'),$$(".status_activity").html('<div class="content status_andamento"><span class="">Em Andamento</span></div>'),$$(".right_tab_act").html('<a href="#tab-2" class="submit-btn tab-link"><img src="assets/img/icons/arrow.png" alt=""></a>'),setTimeout(function(){$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),call_open_events_off(),call_open_events_groups_off(_),get_info_gerais_off(e)},200),n='<div class="col-100"><button id="finalizar" class="button btn_status_finalizado change_status_service scaleffect no-active-state">Finalizar Atividade</button></div>',$$("#box_finish_action").html(n),app.toast.create({text:"Salvo com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),setTimeout(function(){$$(".change_status_approve").on("click",function(t){t.preventDefault();let i=this.id;var n;if("concluido"==i)if(n="Aprovar a Atividade",1==v.flow_approve){var o=$$(".has_sign_tec").attr("src");if(null==o||"undefined"==o)return void app.toast.create({text:"Obrigatório Assinatura Responsável Técnico!",closeTimeout:2e3,cssClass:"error_toast"}).open()}else $$("#box_finish_action").html("");if("reprovado"==i){n="Reprovar a Atividade";var l=app.sheet.create({el:".open_modal_approve",swipeToClose:!1,swipeToStep:!1,backdrop:!0,closeByBackdropClick:!1,closeByOutsideClick:!1});l.open();var c="";c='<div class="item-inner"><div class="item-input-wrap"><br><textarea id="reprove_message_" cols="30" rows="10" placeholder="Digite sua Justificativa"></textarea><br><button class="btn scaleffect no-active-state button btn_confirma_reprove">Confirmar</button><br><br><button style="background:#F44336" class="btn button scaleffect no-active-state close_manual" id="close_manual" >Cancelar</button></div></div>'+$$("#box_noapprove").html(c),$$(".close_manual").on("click",function(e){e.preventDefault(),l.close()}),$$(".btn_confirma_reprove").on("click",function(t){t.preventDefault();var s=$$("#reprove_message_").val();fetch(current_path+"/view/repprove_event",{method:"POST",headers:new Headers,body:JSON.stringify({repprove_message:s,eventID:e,acao:i,id_funcionario:a})}).then(e=>e.json()).then(t=>{if("SUCCESS"==t.status){console.log("the_status concluido - "+i),"reprovado"==i?($$("#btn_action_service").html('<button id="comecar" class="btn button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '),$$("#box_finish_action").html("")):$$("#box_finish_action").html(""),l.close();let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id,t.type;$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),get_info_gerais(e),call_open_events(),call_open_events_groups(_)}}).catch(e=>console.log(e))})}else app.dialog.confirm("Você tem certeza que deseja "+n+" ?","Confirmação ",function(){fetch(current_path+"/view/alteraStatus",{method:"POST",headers:new Headers,body:JSON.stringify({eventID:e,acao:i,id_funcionario:a,id_form:s})}).then(e=>e.json()).then(t=>{if("SUCCESS"==t.status){if("concluido"==i)$$("#btn_action_service").html(""),$$("#status_servico").html('<div class="content status_concluido"><span class="status_concluido ">Concluído</span></div>'),app.toast.create({text:"Salvo com Sucesso",closeTimeout:2e3,cssClass:"success_toast"}).open();"reprovar"==i&&($$("#btn_action_service").html('<button id="comecar" class="button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '));let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id,t.type;$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),$$("#box_finish_action").remove(),call_open_events(),get_info_gerais(e),call_open_events_groups(_)}}).catch(e=>console.log(e))})})},500);else if("Em Andamento"==t){$$("#status_servico").html('<div class="content status_andamento"><span class="">Em Andamento</span></div>'),$$(".status_activity").html('<div class="content status_andamento"><span class="">Em Andamento</span></div>'),$$(".right_tab_act").html('<a href="#tab-2" class="submit-btn tab-link"><img src="assets/img/icons/arrow.png" alt=""></a>'),n='<div class="col-100"><button id="finalizar" class="button btn_status_finalizado change_status_service scaleffect no-active-state">Finalizar Atividade</button></div>',$$("#box_finish_action").html(n),setTimeout(function(){$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),call_open_events_off(),call_open_events_groups_off(_),get_info_gerais_off(e)},200),app.toast.create({text:"Salvo com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open()}else if("cancelar"==t){$$("#btn_action_service").html('<button class="button btn_status_cancelado">Cancelado</button>'),$$("#status_servico").html('<div class="content status_cancelado"><span class="">Cancelado</span></div> '),$$(".status_activity").html('<div class="content status_cancelado"><span class="">Cancelado</span></div> '),open_manual_Tag.close();let e=Utils.userData();null!=e&&"null"!=e||app.views.main.router.navigate({name:"sign-in"});e.id,e.type;app.toast.create({text:"Salvo com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open()}else if("finalizar"==t){let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id;let i=t.type;var l="",c="";if(1==v.signature_exec){if(null==(c=$$(".has_sign_rest_exec").attr("src"))||"undefined"==c)return void app.toast.create({text:"Obrigatório Assinatura Responsável Execução!",closeTimeout:2e3,cssClass:"error_toast"}).open();if(1==v.signature){if(null==(l=$$(".has_sign_client").attr("src"))||"undefined"==l)return void app.toast.create({text:"Obrigatório Assinatura Cliente",closeTimeout:2e3,cssClass:"error_toast"}).open();"a"==i||"g"==i||"r"==i?$$("#box_finish_action").html('<button style="float:left;width:48%;margin-right:5px;font-size:16px;height:45px;" id="concluido" class="status_approve  button btn_approve change_status_approve scaleffect">Aprovar</button><button id="reprovado"  style="float:left;width:48%;font-size:16px;height:45px;" class="btn_repprove status_repprove button btn_status_reprovar change_status_approve scaleffect">Reprovar</button>'):$$("#box_finish_action").html(""),$$("#status_servico").html('<div class="content status_finalizado"><span class="">Finalizado</span></div>'),$$(".status_activity").html('<div class="content status_finalizado"><span class="">Finalizado</span></div>')}else"a"==i||"g"==i||"r"==i?$$("#box_finish_action").html('<button style="float: left;width:48%;margin-right:5px;font-size:16px;height:45px;" id="concluido" class="status_approve  button btn_approve change_status_approve scaleffect">Aprovar</button><button id="reprovado"  style="float:left;width:48%;font-size:16px;height:45px;" class="btn_repprove status_repprove button btn_status_reprovar change_status_approve scaleffect">Reprovar</button>'):$$("#box_finish_action").html(""),$$("#status_servico").html('<div class="content status_finalizado"><span class="">Finalizado</span></div>'),$$(".status_activity").html('<div class="content status_finalizado"><span class="">Finalizado</span></div>')}app.toast.create({text:"Salvo com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),$$("input,textarea,select").prop("disabled",!0),$$("#box_save_checklist").hide(),$$("#box_images_up").hide(),$$("#phone_cliente").prop("disabled",!1),$$("#zap_message").prop("disabled",!1),$$(".change_status_approve").on("click",function(t){t.preventDefault();let i=this.id;var n;if("concluido"==i&&(n="Aprovar a Atividade",1==v.flow_approve)){var o=$$(".has_sign_tec").attr("src");if(null==o||"undefined"==o)return void app.toast.create({text:"Obrigatório Assinatura Responsável Técnico!",closeTimeout:2e3,cssClass:"error_toast"}).open()}if("reprovado"==i){n="Reprovar a Atividade";var l=app.sheet.create({el:".open_modal_approve",swipeToClose:!1,swipeToStep:!1,backdrop:!0,closeByBackdropClick:!1,closeByOutsideClick:!1});l.open();'<li class="item-content item-input"><div class="item-inner"><div class="item-input-wrap"><br><textarea id="reprove_message_" cols="30" rows="10" placeholder="Digite sua Justificativa"></textarea><br><button class="btn scaleffect no-active-state button btn_confirma_reprove">Confirmar</button><br><br><button style="background:#F44336" class="btn button scaleffect no-active-state close_manual" id="close_manual" >Cancelar</button></div></div></li>',$$("#box_noapprove").html('<li class="item-content item-input"><div class="item-inner"><div class="item-input-wrap"><br><textarea id="reprove_message_" cols="30" rows="10" placeholder="Digite sua Justificativa"></textarea><br><button class="btn scaleffect no-active-state button btn_confirma_reprove">Confirmar</button><br><br><button style="background:#F44336" class="btn button scaleffect no-active-state close_manual" id="close_manual" >Cancelar</button></div></div></li>'),$$(".close_manual").on("click",function(e){e.preventDefault(),l.close()}),$$(".btn_confirma_reprove").on("click",function(t){t.preventDefault();var s=$$("#reprove_message_").val();fetch(current_path+"/view/repprove_event",{method:"POST",headers:new Headers,body:JSON.stringify({repprove_message:s,eventID:e,acao:i,id_funcionario:a})}).then(e=>e.json()).then(t=>{if("SUCCESS"==t.status){"reprovado"==i?($$("#btn_action_service").html('<button id="comecar" class="btn button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '),$$("#box_finish_action").html("")):$$("#box_finish_action").html(""),l.close();let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id,t.type;$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),get_info_gerais(e),call_open_events(),call_open_events_groups(_)}}).catch(e=>console.log(e))})}else app.dialog.confirm("Você tem certeza que deseja "+n+" ?","Confirmação ",function(){fetch(current_path+"/view/alteraStatus",{method:"POST",headers:new Headers,body:JSON.stringify({eventID:e,acao:i,id_funcionario:a,id_form:s})}).then(e=>e.json()).then(t=>{if("SUCCESS"==t.status){if("concluido"==i)$$("#btn_action_service").html(""),$$("#status_servico").html('<div class="content status_concluido"><span class="status_concluido ">Concluído</span></div>'),app.toast.create({text:"Salvo com Sucesso",closeTimeout:2e3,cssClass:"success_toast"}).open();"reprovar"==i&&($$("#btn_action_service").html('<button id="comecar" class="button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '));let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id,t.type;$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),get_info_gerais(e),call_open_events(),call_open_events_groups(_)}}).catch(e=>console.log(e))})}),$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),get_info_gerais_off(e),call_open_events_off(),call_open_events_groups_off(_)}else if("concluido"==t){$$("#btn_action_service").html(""),$$("#box_save_checklist").html(""),$$("#status_servico").html('<div class="content status_concluido "><span class="">Concluído</span></div> '),$$(".status_activity").html('<div class="content status_concluido "><span class="">Concluído</span></div> ');let t=Utils.userData();null!=t&&"null"!=t||app.views.main.router.navigate({name:"sign-in"});t.id,t.type;app.toast.create({text:"Salvo com Sucesso!",closeTimeout:2e3,cssClass:"success_toast"}).open(),0==v.flow_approve&&$("#box_finish_action").html(""),$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),get_info_gerais_off(e),call_open_events_off(),call_open_events_groups_off(_)}else"reprovar"==t&&($$("#btn_action_service").html('<button id="comecar" class="button btn_status_pendente change_status_service scaleffect no-active-state ">Iniciar Atividade</button>'),$$("#status_servico").html('<div class="content status_pendente"><span class="">Pendente</span></div> '),$$(".status_activity").html('<div class="content status_pendente"><span class="">Pendente</span></div> '),$$("#box_sig_cli").html(""),$$("#box_sig_cli").append('<div class="block"><label class="block-title">Assinaturas</label></div>'),get_info_gerais_off(e),call_open_events_off(),call_open_events_groups_off(_))}}}function getDateTime(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,s=e.getDate(),i=e.getHours(),n=e.getMinutes(),o=e.getSeconds();return 1==a.toString().length&&(a="0"+a),1==s.toString().length&&(s="0"+s),1==i.toString().length&&(i="0"+i),1==n.toString().length&&(n="0"+n),1==o.toString().length&&(o="0"+o),t+"-"+a+"-"+s+" "+i+":"+n+":"+o}$$(".back-last").on("click",function(e){e.preventDefault(),app.views.current.router.back()}),navigator.permissions&&navigator.permissions.query&&navigator.permissions.query({name:"geolocation"}).then(function(e){e.state;e.onchange=function(){}});